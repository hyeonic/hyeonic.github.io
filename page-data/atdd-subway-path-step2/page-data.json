{"componentChunkName":"component---src-templates-post-jsx","path":"/atdd-subway-path-step2/","result":{"data":{"site":{"siteMetadata":{"title":"나누면 배가 되고"}},"markdownRemark":{"id":"46405f9c-f765-5897-b294-99ac7b74b9bf","excerpt":"목표  우아한테크코스에서 진행한 미션의 리뷰와 피드백에 대해 정리한다. 실제 리뷰는 [Spring 경로 조회 - 2단계] 매트(최기현) 미션 제출합니다.에서 확인할 수 있다. 06. 2단계 - 지하철 경로 조회 확인 2단계에서는 기존 로직에서 요금 정책에 대한 기능들이 추가되었다. 실제로 운영되고 있는 지하철 요금 정책을 대부분 적용했기 때문에 실제 존재…","html":"<h2>목표</h2>\n<p><img src=\"https://user-images.githubusercontent.com/59357153/152970395-a31c8134-fc89-449f-b4dc-441e03df929c.png\"></p>\n<p>우아한테크코스에서 진행한 미션의 리뷰와 피드백에 대해 정리한다. 실제 리뷰는 <a href=\"https://github.com/woowacourse/atdd-subway-path/pull/272\">[Spring 경로 조회 - 2단계] 매트(최기현) 미션 제출합니다.</a>에서 확인할 수 있다.</p>\n<h2>06. 2단계 - 지하철 경로 조회 확인</h2>\n<p>2단계에서는 기존 로직에서 요금 정책에 대한 기능들이 추가되었다. 실제로 운영되고 있는 지하철 요금 정책을 대부분 적용했기 때문에 실제 존재하는 서비스를 만드는 듯한 느낌도 가져갈 수 있었다.</p>\n<p>또한 1단계에서 <code class=\"language-text\">도메인에서 특정 라이브러리를 의존하는 문제</code>에 대한 리뷰가 있었다. 이것을 개선하기 위해 다양한 고민을 진행했으며 나름의 기준도 잡히게 되어 많은 것들을 얻을 수 있는 시간이 되었다.</p>\n<h2>특정 라이브러리에 종속적인 도메인</h2>\n<p>도메인이 외부 라이브러리에 강하게 의존하게 되면 외부 라이브러리의 변경에 도메인이 매우 취약한 구조가 된다고 생각한다. 많은 고민 끝에 <code class=\"language-text\">외부 라이브러리를 사용하는 행위</code> 자체를 추상화하여 <code class=\"language-text\">PathService에 주입</code>하는 형태로 개선하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PathFindable</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Path</span> <span class=\"token function\">findPath</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Section</span><span class=\"token punctuation\">></span></span> sections<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Station</span> source<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Station</span> target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>경로를 찾기 위해 <code class=\"language-text\">findPath</code>를 가진 <code class=\"language-text\">PathFindable</code> 인터페이스이다. 위 인터페이스를 구현한 구현체가 외부 라이브러리를 가질 수 있도록 작성했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ShortestPathFindable</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">PathFindable</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">WeightedMultigraph</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Station</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">DefaultWeightedEdge</span><span class=\"token punctuation\">></span></span> graph<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ShortestPathFindable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>graph <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WeightedMultigraph</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SectionEdge</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>readOnly <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PathService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PathFindable</span> pathFindable<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PathService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SectionDao</span> sectionDao<span class=\"token punctuation\">,</span> <span class=\"token class-name\">StationService</span> stationService<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PathFindable</span> pathFindable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pathFindable <span class=\"token operator\">=</span> pathFindable<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 도메인에서 더이상 외부 라이브러리를 의존하지 않고 있다. 또한 추후 경로 조회에 대한 요구사항이 변경되면 해당 인터페이스를 기반으로 추가적으로 구현하여 <code class=\"language-text\">Bean</code>으로 등록하면 손쉽게 <code class=\"language-text\">PathService</code>의 의존성을 변경할 수 있다.</p>\n<p>더 나아가 현재 패키지 구조는 서비스 패키지에서 해당 인터페이스와 구현체를 모두 가지고 있다. 구현체는 외부 라이브러리를 강하게 의존하고 있기 때문에 도메인의 핵심 비즈니스 로직을 담당하는 서비스 패키지 내부에 위치하는 것이 맞는지에 대한 고민이 있다. 구현체만 외부 패키지 (ex. support)에 두면 도메인 내에 외부 라이브러리의 강한 의존성을 끊어낼 수 있지 않을까 생각한다.</p>\n<h2>OCP를 지키자</h2>\n<p>처음 요금 계산을 진행하기 위해 나이 조건 마다 분기 처리를 위한 if문을 작성하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Fare</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> <span class=\"token function\">reduceFare</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> fare<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>age <span class=\"token operator\">>=</span> <span class=\"token number\">13</span> <span class=\"token operator\">&amp;&amp;</span> age <span class=\"token operator\">&lt;</span> <span class=\"token number\">19</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>fare <span class=\"token operator\">-</span> <span class=\"token constant\">DEDUCTION</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>age <span class=\"token operator\">>=</span> <span class=\"token number\">6</span> <span class=\"token operator\">&amp;&amp;</span> age <span class=\"token operator\">&lt;</span> <span class=\"token number\">13</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>fare <span class=\"token operator\">-</span> <span class=\"token constant\">DEDUCTION</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> fare<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>해당 구조는 결국 나이에 대한 조건이 추가된다면 if문이 늘어날 수 밖에 없는 구조를 야기한다. 이것을 개선하기 위해 아래와 같이 enum을 활용하였다.</p>\n<p>아래는 거리 비례로 요금 계산을 위한 <code class=\"language-text\">DistanceProportionCalculator</code>이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">DistanceProportionCalculator</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">DEFAULT_STANDARD</span><span class=\"token punctuation\">(</span>distance <span class=\"token operator\">-></span> <span class=\"token number\">0</span> <span class=\"token operator\">&lt;=</span> distance <span class=\"token operator\">&amp;&amp;</span> distance <span class=\"token operator\">&lt;=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> ignored <span class=\"token operator\">-></span> <span class=\"token number\">1250</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">FIRST_STANDARD</span><span class=\"token punctuation\">(</span>distance <span class=\"token operator\">-></span> <span class=\"token number\">10</span> <span class=\"token operator\">&lt;</span> distance <span class=\"token operator\">&amp;&amp;</span> distance <span class=\"token operator\">&lt;=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span>\n            distance <span class=\"token operator\">-></span> <span class=\"token number\">1250</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>distance <span class=\"token operator\">-</span> <span class=\"token number\">10</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">SECOND_STANDARD</span><span class=\"token punctuation\">(</span>distance <span class=\"token operator\">-></span> distance <span class=\"token operator\">></span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span>\n            distance <span class=\"token operator\">-></span> <span class=\"token number\">2050</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>distance <span class=\"token operator\">-</span> <span class=\"token number\">50</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Predicate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> condition<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> function<span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">DistanceProportionCalculator</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Predicate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> condition<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> function<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>condition <span class=\"token operator\">=</span> condition<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>function <span class=\"token operator\">=</span> function<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">DistanceProportionCalculator</span> <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> distance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>it <span class=\"token operator\">-></span> it<span class=\"token punctuation\">.</span>condition<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">findFirst</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span>distance <span class=\"token operator\">+</span> <span class=\"token string\">\"는 계산이 불가능한 거리입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">calculateFare</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> distance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> function<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그 다음 나이별로 할인을 적용하기 위한 <code class=\"language-text\">AgeDiscounter</code>이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">AgeDiscounter</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">INFANT</span><span class=\"token punctuation\">(</span>age <span class=\"token operator\">-></span> <span class=\"token number\">0</span> <span class=\"token operator\">&lt;=</span> age <span class=\"token operator\">&amp;&amp;</span> age <span class=\"token operator\">&lt;</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> fare <span class=\"token operator\">-></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">CHILDREN</span><span class=\"token punctuation\">(</span>age <span class=\"token operator\">-></span> <span class=\"token number\">6</span> <span class=\"token operator\">&lt;=</span> age <span class=\"token operator\">&amp;&amp;</span> age <span class=\"token operator\">&lt;</span> <span class=\"token number\">13</span><span class=\"token punctuation\">,</span> fare <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>fare <span class=\"token operator\">-</span> <span class=\"token number\">350</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">TEENAGER</span><span class=\"token punctuation\">(</span>age <span class=\"token operator\">-></span> <span class=\"token number\">13</span> <span class=\"token operator\">&lt;=</span> age <span class=\"token operator\">&amp;&amp;</span> age <span class=\"token operator\">&lt;</span> <span class=\"token number\">19</span><span class=\"token punctuation\">,</span> fare <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>fare <span class=\"token operator\">-</span> <span class=\"token number\">350</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">ORDINAL</span><span class=\"token punctuation\">(</span>age <span class=\"token operator\">-></span> age <span class=\"token operator\">>=</span> <span class=\"token number\">19</span><span class=\"token punctuation\">,</span> fare <span class=\"token operator\">-></span> fare<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Predicate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> condition<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> function<span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">AgeDiscounter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Predicate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> condition<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> function<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>condition <span class=\"token operator\">=</span> condition<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>function <span class=\"token operator\">=</span> function<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">AgeDiscounter</span> <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> age<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>it <span class=\"token operator\">-></span> it<span class=\"token punctuation\">.</span>condition<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">findFirst</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span>age <span class=\"token operator\">+</span> <span class=\"token string\">\"는 할인할 수 없는 나이입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">discount</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> fare<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> function<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>fare<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 Fare는 제공된 distance, age, extraFare를 기반으로 필요한 부분을 적절히 호출하여 계산할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Fare</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> distance<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> extraFare<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Fare</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> distance<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> extraFare<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distance <span class=\"token operator\">=</span> distance<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>extraFare <span class=\"token operator\">=</span> extraFare<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">calculateFare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">DistanceProportionCalculator</span> distanceProportionCalculator <span class=\"token operator\">=</span> <span class=\"token class-name\">DistanceProportionCalculator</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> fare <span class=\"token operator\">=</span> distanceProportionCalculator<span class=\"token punctuation\">.</span><span class=\"token function\">calculateFare</span><span class=\"token punctuation\">(</span>distance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">AgeDiscounter</span> ageDiscounter <span class=\"token operator\">=</span> <span class=\"token class-name\">AgeDiscounter</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> ageDiscounter<span class=\"token punctuation\">.</span><span class=\"token function\">discount</span><span class=\"token punctuation\">(</span>fare <span class=\"token operator\">+</span> extraFare<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>비즈니스 로직은 도메인 내부로</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>readOnly <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PathService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getMaxExtraFare</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Path</span> shortestPath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Section</span><span class=\"token punctuation\">></span></span> sections <span class=\"token operator\">=</span> shortestPath<span class=\"token punctuation\">.</span><span class=\"token function\">getSections</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> sections<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Section</span><span class=\"token operator\">::</span><span class=\"token function\">getLine</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">mapToInt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Line</span><span class=\"token operator\">::</span><span class=\"token function\">getExtraFare</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElse</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DEFAULT_EXTRA_FARE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>리뷰 중 일부</h4>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token code-snippet code keyword\">`리뷰어`</span>: 해당 로직은 service보다 더 적절한 곳이 있을 것 같아요. 😎</code></pre></div>\n<h3>Transaction Script Pattern</h3>\n<p>Service 계층에서 절차지향에 가까운 코드로 비즈니스 로직을 작성하는 것을 마틴파울러는 <code class=\"language-text\">Transaction Script Pattern</code>이라 불렀다.</p>\n<p>위 방법은 객체지향 설계보다 단순히 표현 계층의 요청을 처리하기 위한 로직을 Service 계층 내부에 작성한다는 것이다. 결국 로직을 통해 도출된 객체의 경우 단순히 데이터를 표현하기 위한 용도로 사용되기 때문에 객체 내부에 행위를 가지지 않게 된다.</p>\n<h3>Domain Model Pattern</h3>\n<p><code class=\"language-text\">Transaction Script Pattern</code>은 매우 단순하여 빠르게 로직을 구현할 수 있지만 비즈니스 로직 자체가 복잡해지면 유지보수에 매우 취약한 구조를 야기한다.</p>\n<p>즉 객체지향 설계를 기반으로 비즈니스 로직을 도메인 객체 내부로 이동해야 한다. 객체 내부로 적절히 캡슐화하여 기능만 외부에 제공하는 방식으로 진행하면 데이터의 변경이 생겨도 핵심 비즈니스 로직에는 최소한의 영향을 끼치며 유지보수를 진행할 수 있게 된다.</p>\n<p>객체지향 설계는 다양한 도메인 모델을 표현하기 위해 추가적인 객체를 작성해야하며 관리해야할 포인트들이 늘어난다. 그럼에도 객체지향 설계를 진행해야 하는 이유는 무엇일까?</p>\n<ul>\n<li>설계에 대한 이해와 유지보수에 용이하다. 각각의 객체는 작은 책임을 가지기 때문에 각 객체의 역할을 쉽게 확인할 수 있으며 책임의 변화에도 쉽게 변경할 수 있다.</li>\n<li>테스트하기 쉬워진다. 각각의 객체들에 비즈니스 로직이 들어있기 때문에 순수한 Java 코드를 기반으로 독립된 테스트를 진행할 수 있다.</li>\n<li>확장하기 용이한 구조이다. 다양한 디자인 패턴이나 다형성을 활용하여 실제 코드를 수정하지 않고 내부 구현체를 바꾸는 행위만으로 확장에 용이한 구조를 만들 수 있다.</li>\n</ul>\n<p>이제 관련 리뷰를 다시 한번 살펴보자.</p>\n<h4>리뷰 중 일부</h4>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token code-snippet code keyword\">`리뷰어`</span>: 해당 로직은 service보다 더 적절한 곳이 있을 것 같아요. 😎</code></pre></div>\n<p>기존에 Service 계층에 작성된 <code class=\"language-text\">getMaxExtraFare</code>를 도메인 객체 내부로 이동하여 개선한다.</p>\n<h4>리뷰 중 일부</h4>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token code-snippet code keyword\">`매트`</span>: 언급하신 것 처럼 Lin 컬렉션을 관리하기 위한 Lines를 생성하여 가장 큰 추가 요금을 반환할 수 있도록 개선하였습니다!</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Lines</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">DEFAULT_EXTRA_FARE</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Line</span><span class=\"token punctuation\">></span></span> value<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Lines</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Line</span><span class=\"token punctuation\">></span></span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getMaxExtraFare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">mapToInt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Line</span><span class=\"token operator\">::</span><span class=\"token function\">getExtraFare</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElse</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DEFAULT_EXTRA_FARE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>정리</h2>\n<p>우테코 이전에 작성한 웹 애플리케이션을 살펴보면 Service 계층에 온갖 중요한 비즈니스 로직을 모두 작성하였다. 당시에는 객체지향에 대한 개념 조차 잡히지 않았으며 왜 그렇게 해야 하는지 조차 인지하지 못했기 때문이다. </p>\n<p>또한 도메인이 외부 라이브러리에 의존하는 것이 문제인지 조차 인지하지 못했다. 단순히 주어진 과업을 해결하기 위해 동작만 하도록 만들었다. 하지만 해당 코드들은 내가 작성했지만 리팩토링하기 쉽지 않았다. </p>\n<p>객체지향 설계는 많은 이점을 가져온다. 테스트가 용이한 구조가 되며 확장에는 유연하게 대처할 수 있다. 우리는 더 이상 객체지향 설계를 고려하지 않고 작성할 이유가 없다고 생각한다.</p>\n<h2>References.</h2>\n<ul>\n<li><a href=\"https://github.com/msbaek/memo/blob/master/Business-Logic-Organization-Patterns.md\">Business Logic Organization Patterns</a></li>\n</ul>","frontmatter":{"title":"[레벨 2] 06. 2단계 - 지하철 경로 조회","date":"June 17, 2022","update":"June 17, 2022","tags":["우아한테크코스","레벨2","미션"],"series":"우아한테크코스 레벨2"},"fields":{"slug":"/atdd-subway-path-step2/","readingTime":{"minutes":11.52}}},"seriesList":{"edges":[{"node":{"id":"d4b6d632-cd5f-543f-a9a6-db1995b81aab","fields":{"slug":"/jwp-chess-step1/"},"frontmatter":{"title":"[레벨 2] 01. 사전 준비, 1단계 - 웹 체스"}}},{"node":{"id":"85419abc-c066-522b-b67a-b4f7adec2719","fields":{"slug":"/jwp-chess-step2/"},"frontmatter":{"title":"[레벨 2] 02. 2단계 - 웹 체스"}}},{"node":{"id":"0187b675-7a80-5588-94d9-a7bb02396071","fields":{"slug":"/atdd-subway-map-step1/"},"frontmatter":{"title":"[레벨 2] 03. 1, 2단계 - 지하철 노선도"}}},{"node":{"id":"1a3b11fe-a700-5797-acf9-f821623d6b81","fields":{"slug":"/atdd-subway-map-step2/"},"frontmatter":{"title":"[레벨 2] 04. 3단계 - 지하철 노선도"}}},{"node":{"id":"66a7cc25-e3d5-5ae3-b843-1cc5ff745f90","fields":{"slug":"/atdd-subway-path-step1/"},"frontmatter":{"title":"[레벨 2] 05. 사전 준비, 1단계 - 지하철 경로 조회"}}},{"node":{"id":"46405f9c-f765-5897-b294-99ac7b74b9bf","fields":{"slug":"/atdd-subway-path-step2/"},"frontmatter":{"title":"[레벨 2] 06. 2단계 - 지하철 경로 조회"}}},{"node":{"id":"bdeb9ce6-d9ab-5297-9e94-91374bfa86db","fields":{"slug":"/jwp-shopping-cart-step1/"},"frontmatter":{"title":"[레벨 2] 07. 1단계 - 장바구니 - 협업 미션"}}},{"node":{"id":"5b94303c-ab34-5ec1-ac86-5ef82deff412","fields":{"slug":"/jwp-shopping-cart-step2/"},"frontmatter":{"title":"[레벨 2] 08. 2단계 - 장바구니/주문 API 변경하기"}}}]},"previous":{"fields":{"slug":"/atdd-subway-path-step1/"},"frontmatter":{"title":"[레벨 2] 05. 사전 준비, 1단계 - 지하철 경로 조회"}},"next":{"fields":{"slug":"/jwp-shopping-cart-step1/"},"frontmatter":{"title":"[레벨 2] 07. 1단계 - 장바구니 - 협업 미션"}}},"pageContext":{"id":"46405f9c-f765-5897-b294-99ac7b74b9bf","series":"우아한테크코스 레벨2","previousPostId":"66a7cc25-e3d5-5ae3-b843-1cc5ff745f90","nextPostId":"bdeb9ce6-d9ab-5297-9e94-91374bfa86db"}},"staticQueryHashes":[],"slicesMap":{}}