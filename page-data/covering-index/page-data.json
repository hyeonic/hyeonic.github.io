{"componentChunkName":"component---src-templates-post-jsx","path":"/covering-index/","result":{"data":{"site":{"siteMetadata":{"title":"나누면 배가 되고"}},"markdownRemark":{"id":"fa938264-2615-556e-bcfa-d749c30aa8fe","excerpt":"커버링 인덱스 MySQL 8.0 이상, InnoDB 스토리지 엔진을 기준으로 작성되었다. 인덱스를 사용하여 처리하는 쿼리 중 가장 큰 부하를 차지하는 부분은 어디일까? 바로 인덱스 검색에서 일치하는 키 값의 이다. 그림을 살펴보면 인덱스 검색에서 일치하는 키 값을 데이터 파일에서 읽을 때 비교적 느린 속도를 가진 디스크 I/O가 발생한다.  N개의 인덱스…","html":"<h2>커버링 인덱스</h2>\n<blockquote>\n<p>MySQL 8.0 이상, InnoDB 스토리지 엔진을 기준으로 작성되었다.</p>\n</blockquote>\n<p>인덱스를 사용하여 처리하는 쿼리 중 가장 큰 부하를 차지하는 부분은 어디일까? 바로 인덱스 검색에서 일치하는 키 값의 <code class=\"language-text\">레코드를 읽는 것</code>이다.</p>\n<p>그림을 살펴보면 인덱스 검색에서 일치하는 키 값을 데이터 파일에서 읽을 때 비교적 느린 속도를 가진 디스크 I/O가 발생한다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/46b7920cf54fecb35ad24cfd8a5d43be/687ee/image-1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 48.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACgklEQVR42jWSS09TURDHu5AYhVb6fkIv7e1t6e27tkhLeZSiUQENuiHRz2DiTiMp4vtraOJCEzX42Ji6ICRq0sRYg9CGSsGVlmJbWrFl8XfuEU8yOTPn8Zv5nzMyndmF0MAYxEAckq+z9KNbZ4dSz0Pf00+xC4YeNwy9buZ7gwmMjE/B7Y9BS+eNtC7t/78rU+kFqA0ClDoeCo0NGpMLKoMDaqMTGrIuFYeOThOzQ0eN6FRaKZmDZo7FHZ1GHJabIVfbWALZ8NhZBCMjiMZSGE5OMlCXqg/dWp75NmcEc+k7mF+4j/T8XVy/scDiufRtWruHm7ce4MrVa6wQjZGAhUIB5Z8/UKmUkfucgzc0AsF9AuFoCi5PDNMzl9FsNNFut9FqtbC7Wye/he9bm9jb24M0CoV1ku4lpU7IMu+WsLz8Ee8/ZPH6zVsI4iCcYgyiL8Gqmzp/CeVyGbVaDdVqDdvbFZqr2NgoYWdnh5L8QS63Qu94AOy1h6BQ21nQYwuSVAFHFBxMVj/srijGJmYIss0gjUYD9Xqd+fl8/gDYQu6LBPQRgyQ/efoMz18sYvHlKzx89Jiqi9ObppAYnSbJcZyenMUvAjSbTVZNk6C/yZeAknxprK0VSLL/H7BykGV/fx+bm1vwhZLQW3wso1LrhC+cxMrXNfZOxeIGit9KBFtHNvsJq6t5lEpbyGSW2HmNSYTs1JlZDI2ew2jqApInL9JPiTimEcic1FseWLggrHwEHB+l+Tj6HFFmNmEAvGuQVAzRJ8ZhtgagNXogU+vdkHfzVA01scnLFpU6NwGpH/UirPYoTL0huhCEmQuBI5jVHiGJAQLF4A+PwxdMwtIXZnf+AntFr8Pzd3PfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 1' title='' src='/static/46b7920cf54fecb35ad24cfd8a5d43be/ca1dc/image-1.png' srcset='/static/46b7920cf54fecb35ad24cfd8a5d43be/e7570/image-1.png 170w,\n/static/46b7920cf54fecb35ad24cfd8a5d43be/f46e7/image-1.png 340w,\n/static/46b7920cf54fecb35ad24cfd8a5d43be/ca1dc/image-1.png 680w,\n/static/46b7920cf54fecb35ad24cfd8a5d43be/02d09/image-1.png 1020w,\n/static/46b7920cf54fecb35ad24cfd8a5d43be/9d567/image-1.png 1360w,\n/static/46b7920cf54fecb35ad24cfd8a5d43be/687ee/image-1.png 1838w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>N개의 인덱스 검색 시 최악의 경우 N번의 디스크 I/O가 발생할 수 있다. </p>\n<p>이것을 커버링 인덱스를 활용하여 개선할 수 있다. 커버링 인덱스는 데이터 파일을 읽지 않고 인덱스만 읽어 불필요한 디스크 I/O를 줄일 수 있다.</p>\n<p>먼저 간단한 예제를 위한 crew 테이블이다. 데이터는 대략 <code class=\"language-text\">100만건</code>을 기준으로 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> crew <span class=\"token punctuation\">(</span>\n    id <span class=\"token keyword\">INT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n    nickname <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    track <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">year</span> <span class=\"token keyword\">INT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">CONSTRAINT</span> pk_crew_id <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">id</code>: 고유 식별자</li>\n<li><code class=\"language-text\">nickname</code>: 닉네임</li>\n<li><code class=\"language-text\">track</code>: 진행 중인 track (e.g. FRONTEND, BACKEND 등)</li>\n<li><code class=\"language-text\">year</code>: 기수 (e.g. 1기, 2기 등)</li>\n</ul>\n<h2>인덱스 설정</h2>\n<p>crew 테이블에서 닉네임이 <code class=\"language-text\">a ~ d</code> 사이이며 <code class=\"language-text\">BACKEND</code> 트랙을 진행 중인 크루를 조회한다고 가정한다. 쿼리로 표현하면 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> \n<span class=\"token keyword\">FROM</span> crew \n<span class=\"token keyword\">WHERE</span> nickname <span class=\"token operator\">BETWEEN</span> <span class=\"token string\">'a'</span> <span class=\"token operator\">AND</span> <span class=\"token string\">'d'</span> <span class=\"token operator\">AND</span> track <span class=\"token operator\">=</span> <span class=\"token string\">'BACKEND'</span><span class=\"token punctuation\">;</span>   </code></pre></div>\n<p>위 쿼리에 인덱스를 적용하기 위해 <code class=\"language-text\">nickname</code>과 <code class=\"language-text\">track</code>으로 복합 인덱스를 설정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> crew <span class=\"token keyword\">ADD</span> <span class=\"token keyword\">INDEX</span> idx_crew_nickname_track <span class=\"token punctuation\">(</span>nickname<span class=\"token punctuation\">,</span> track<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   </code></pre></div>\n<p>이제 실행 계획을 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">EXPLAIN</span> <span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> crew <span class=\"token keyword\">WHERE</span> nickname <span class=\"token operator\">BETWEEN</span> <span class=\"token string\">'a'</span> <span class=\"token operator\">AND</span> <span class=\"token string\">'d'</span> <span class=\"token operator\">AND</span> track <span class=\"token operator\">=</span> <span class=\"token string\">'BACKEND'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------+-------+------------+------+-------------------------+------+---------+------+--------+----------+-------------+    </span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> select_type <span class=\"token operator\">|</span> <span class=\"token keyword\">table</span> <span class=\"token operator\">|</span> partitions <span class=\"token operator\">|</span> <span class=\"token keyword\">type</span> <span class=\"token operator\">|</span> possible_keys           <span class=\"token operator\">|</span> <span class=\"token keyword\">key</span>  <span class=\"token operator\">|</span> key_len <span class=\"token operator\">|</span> ref  <span class=\"token operator\">|</span> <span class=\"token keyword\">rows</span>   <span class=\"token operator\">|</span> filtered <span class=\"token operator\">|</span> Extra       <span class=\"token operator\">|</span>    \n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------+-------+------------+------+-------------------------+------+---------+------+--------+----------+-------------+    </span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">SIMPLE</span>      <span class=\"token operator\">|</span> crew  <span class=\"token operator\">|</span> <span class=\"token boolean\">NULL</span>       <span class=\"token operator\">|</span> <span class=\"token keyword\">ALL</span>  <span class=\"token operator\">|</span> idx_crew_nickname_track <span class=\"token operator\">|</span> <span class=\"token boolean\">NULL</span> <span class=\"token operator\">|</span> <span class=\"token boolean\">NULL</span>    <span class=\"token operator\">|</span> <span class=\"token boolean\">NULL</span> <span class=\"token operator\">|</span> <span class=\"token number\">997049</span> <span class=\"token operator\">|</span>     <span class=\"token number\">3.70</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">Using</span> <span class=\"token keyword\">where</span> <span class=\"token operator\">|</span>    \n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------+-------+------------+------+-------------------------+------+---------+------+--------+----------+-------------+    </span></code></pre></div>\n<p><code class=\"language-text\">*</code>를 활용하여 모든 칼럼을 조회할 경우 옵티마이저는 인덱스를 활용하여 레코드를 읽는 것 보다 데이터 파일을 바로 읽는 것이 더욱 빠르다고 판단하여 <code class=\"language-text\">풀 테이블 스캔(ALL)</code>을 진행한 것을 확인할 수 있다.</p>\n<blockquote>\n<p>인덱스를 통해 레코드를 읽는 것 > 데이터 파일을 바로 읽는 것 (비용 측면)</p>\n</blockquote>\n<h2>커버링 인덱스 활용</h2>\n<p>이제 <code class=\"language-text\">커버링 인덱스</code> 활용을 위해 모든 칼럼을 조회(<code class=\"language-text\">*</code>)하는 쿼리에서 <code class=\"language-text\">nickname</code>과 <code class=\"language-text\">track</code> 칼럼을 활용하여 조회하는 방식으로 개선한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> nickname<span class=\"token punctuation\">,</span> track \n<span class=\"token keyword\">FROM</span> crew \n<span class=\"token keyword\">WHERE</span> nickname <span class=\"token operator\">BETWEEN</span> <span class=\"token string\">'a'</span> <span class=\"token operator\">AND</span> <span class=\"token string\">'d'</span> <span class=\"token operator\">AND</span> track <span class=\"token operator\">=</span> <span class=\"token string\">'BACKEND'</span><span class=\"token punctuation\">;</span>   </code></pre></div>\n<p>다시 실행 계획을 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">EXPLAIN</span> <span class=\"token keyword\">SELECT</span> nickname<span class=\"token punctuation\">,</span> track <span class=\"token keyword\">FROM</span> crew <span class=\"token keyword\">WHERE</span> nickname <span class=\"token operator\">BETWEEN</span> <span class=\"token string\">'a'</span> <span class=\"token operator\">AND</span> <span class=\"token string\">'d'</span> <span class=\"token operator\">AND</span> track <span class=\"token operator\">=</span> <span class=\"token string\">'BACKEND'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+------+--------+----------+--------------------------+   </span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> select_type <span class=\"token operator\">|</span> <span class=\"token keyword\">table</span> <span class=\"token operator\">|</span> partitions <span class=\"token operator\">|</span> <span class=\"token keyword\">type</span>  <span class=\"token operator\">|</span> possible_keys           <span class=\"token operator\">|</span> <span class=\"token keyword\">key</span>                     <span class=\"token operator\">|</span> key_len <span class=\"token operator\">|</span> ref  <span class=\"token operator\">|</span> <span class=\"token keyword\">rows</span>   <span class=\"token operator\">|</span> filtered <span class=\"token operator\">|</span> Extra                    <span class=\"token operator\">|</span>   \n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+------+--------+----------+--------------------------+   </span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">SIMPLE</span>      <span class=\"token operator\">|</span> crew  <span class=\"token operator\">|</span> <span class=\"token boolean\">NULL</span>       <span class=\"token operator\">|</span> range <span class=\"token operator\">|</span> idx_crew_nickname_track <span class=\"token operator\">|</span> idx_crew_nickname_track <span class=\"token operator\">|</span> <span class=\"token number\">164</span>     <span class=\"token operator\">|</span> <span class=\"token boolean\">NULL</span> <span class=\"token operator\">|</span> <span class=\"token number\">368652</span> <span class=\"token operator\">|</span>    <span class=\"token number\">10.00</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">Using</span> <span class=\"token keyword\">where</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">Using</span> <span class=\"token keyword\">index</span> <span class=\"token operator\">|</span>   \n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+------+--------+----------+--------------------------+   </span></code></pre></div>\n<p><code class=\"language-text\">type</code>을 살펴보면 <code class=\"language-text\">Index Range Scan</code>이 발생한 것을 볼 수 있다. 또한 추가적으로 확인해야 할 부분이 있는데, <code class=\"language-text\">Extra</code> 칼럼의 <code class=\"language-text\">Using index</code>이다. 커버링 인덱스를 타게 되면 <code class=\"language-text\">Extra</code> 칼럼에 <code class=\"language-text\">Using index</code>가 표시되는 것을 확인할 수 있다.</p>\n<h2>조회  속도 비교</h2>\n<p>이제 <code class=\"language-text\">모든 칼럼을 조회하는 쿼리</code>와 <code class=\"language-text\">커버링 인덱스가 가능한 쿼리</code>의 조회 속도를 비교해보자. 테이블에는 100만건의 데이터가 있다.</p>\n<p>먼저 모든 칼럼의 조회 속도이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> crew \n<span class=\"token keyword\">WHERE</span> nickname <span class=\"token operator\">BETWEEN</span> <span class=\"token string\">'a'</span> <span class=\"token operator\">AND</span> <span class=\"token string\">'d'</span> <span class=\"token operator\">AND</span> track <span class=\"token operator\">=</span> <span class=\"token string\">'BACKEND'</span><span class=\"token punctuation\">;</span>   \n\n<span class=\"token operator\">+</span><span class=\"token comment\">----------+---------+</span>\n<span class=\"token operator\">|</span> nickname <span class=\"token operator\">|</span> track   <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------+---------+</span>\n<span class=\"token operator\">|</span> a0002ccc <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> a000319e <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> a00058f1 <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>      <span class=\"token operator\">|</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> cfffd6f4 <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> cfffdb4a <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> cffffbb2 <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------+---------+</span>\n<span class=\"token number\">93617</span> <span class=\"token keyword\">rows</span> <span class=\"token operator\">in</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3.04</span> sec<span class=\"token punctuation\">)</span></code></pre></div>\n<p>다음은 커버링 인덱스로 개선한 조회 쿼리이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> nickname<span class=\"token punctuation\">,</span> track \n<span class=\"token keyword\">FROM</span> crew \n<span class=\"token keyword\">WHERE</span> nickname <span class=\"token operator\">BETWEEN</span> <span class=\"token string\">'a'</span> <span class=\"token operator\">AND</span> <span class=\"token string\">'d'</span> <span class=\"token operator\">AND</span> track <span class=\"token operator\">=</span> <span class=\"token string\">'BACKEND'</span><span class=\"token punctuation\">;</span>   \n\n<span class=\"token operator\">+</span><span class=\"token comment\">----------+---------+</span>\n<span class=\"token operator\">|</span> nickname <span class=\"token operator\">|</span> track   <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------+---------+</span>\n<span class=\"token operator\">|</span> a0002ccc <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> a000319e <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> a00058f1 <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>      <span class=\"token operator\">|</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> cfffd6f4 <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> cfffdb4a <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> cffffbb2 <span class=\"token operator\">|</span> BACKEND <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------+---------+  </span>\n<span class=\"token number\">93617</span> <span class=\"token keyword\">rows</span> <span class=\"token operator\">in</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.54</span> sec<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">3.04 sec → 0.54 sec</code> 로 조회 성능이 개선된 것을 확인할 수 있다. 100만건 보다 많은 데이터가 있다면 보다 더 유의미한 차이가 날 것이라 기대한다.</p>\n<h2>커버링 인덱스의 숨겨진 비밀</h2>\n<p>커버링 인덱스에는 한 가지 비밀이 더 숨겨져 있다. 만약 <code class=\"language-text\">프라이머리 키</code>인 <code class=\"language-text\">id</code>를 함께 조회하는 이 쿼리는 어떤 인덱스를 탈까?</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> id<span class=\"token punctuation\">,</span> nickname<span class=\"token punctuation\">,</span> track \n<span class=\"token keyword\">FROM</span> crew \n<span class=\"token keyword\">WHERE</span> nickname <span class=\"token operator\">BETWEEN</span> <span class=\"token string\">'a'</span> <span class=\"token operator\">AND</span> <span class=\"token string\">'d'</span> <span class=\"token operator\">AND</span> track <span class=\"token operator\">=</span> <span class=\"token string\">'BACKEND'</span><span class=\"token punctuation\">;</span>   </code></pre></div>\n<p>실행 계획을 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">EXPLAIN</span> <span class=\"token keyword\">SELECT</span> id<span class=\"token punctuation\">,</span> nickname<span class=\"token punctuation\">,</span> track <span class=\"token keyword\">FROM</span> crew <span class=\"token keyword\">WHERE</span> nickname <span class=\"token operator\">BETWEEN</span> <span class=\"token string\">'a'</span> <span class=\"token operator\">AND</span> <span class=\"token string\">'d'</span> <span class=\"token operator\">AND</span> track <span class=\"token operator\">=</span> <span class=\"token string\">'BACKEND'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+------+--------+----------+--------------------------+   </span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> select_type <span class=\"token operator\">|</span> <span class=\"token keyword\">table</span> <span class=\"token operator\">|</span> partitions <span class=\"token operator\">|</span> <span class=\"token keyword\">type</span>  <span class=\"token operator\">|</span> possible_keys           <span class=\"token operator\">|</span> <span class=\"token keyword\">key</span>                     <span class=\"token operator\">|</span> key_len <span class=\"token operator\">|</span> ref  <span class=\"token operator\">|</span> <span class=\"token keyword\">rows</span>   <span class=\"token operator\">|</span> filtered <span class=\"token operator\">|</span> Extra                    <span class=\"token operator\">|</span>   \n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+------+--------+----------+--------------------------+   </span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">SIMPLE</span>      <span class=\"token operator\">|</span> crew  <span class=\"token operator\">|</span> <span class=\"token boolean\">NULL</span>       <span class=\"token operator\">|</span> range <span class=\"token operator\">|</span> idx_crew_nickname_track <span class=\"token operator\">|</span> idx_crew_nickname_track <span class=\"token operator\">|</span> <span class=\"token number\">164</span>     <span class=\"token operator\">|</span> <span class=\"token boolean\">NULL</span> <span class=\"token operator\">|</span> <span class=\"token number\">368652</span> <span class=\"token operator\">|</span>    <span class=\"token number\">10.00</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">Using</span> <span class=\"token keyword\">where</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">Using</span> <span class=\"token keyword\">index</span> <span class=\"token operator\">|</span>   \n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+------+--------+----------+--------------------------+   </span></code></pre></div>\n<p>앞선 예시와 동일하게 커버링 인덱스를 타는 것을 확인할 수 있다. <code class=\"language-text\">프라이머리 키</code>는 <code class=\"language-text\">복합 인덱스</code>로 설정하지 않았는데 왜 같은 결과가 나올까?</p>\n<p>그에 대한 해답은 <code class=\"language-text\">InnoDB</code>의 <code class=\"language-text\">세컨더리 인덱스</code>의 특수한 구조 덕분이다. 세컨더리 인덱스의 리프 노드는 실제 레코드의 주소를 가지고 있는 것이 아닌, 클러스터드 인덱스가 걸린 프라이머리 키를 주소로 가지고 있다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/814dd7f0b1d91e8a8f1ccd73e462a77b/c852c/image-2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 95.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAADyElEQVR42nVU60/bZRT+zWTVUEYLFFhL7y20RSi9rPOGDt3iJgvDjRgTcZJFExOTEfmAI1sRcCZb1QXww/Cr/4AX4ic3GUSniZISTWhdnMCUlXELKy230vbxnLdrR5P5Jk/P+57L03Pe93eOpDPXQ2ty5qAzO/PO9rpnYKt9GlaHD1a7L8+WH1cvIBmsbhSXW1G6vzoDtS0ni0rNeLX1NNreehcnTrbhyLFT5Fsl7CUP/HOyogrMJWlN9dhHgUpyZCkvNkJRZs2hSGWBkiQTKcoseTaF6uG5qNQiMhWEChUpS63QWzzwPHVYGEsqqonk/6Esq8J+XS1lZxdn5tCZXJB0ZhcKi82QybWC0H3wMPYWVEKuNKFAYUSB0piRuyAn3V55JRoOHYdGXydi95WYwVxSpdEJRq3reTi9h+D2vQRH3bN4sr7h0SC/Gk8jbK4XcLTlDXifOwaHtxEasxsaA5WsUtvR1PwahoevYmBgAIODgxgaGhIyEAigo6MDfr8fH3R14Vx3N64ELuPqxT4M9/kxeP4cPr/QjS8vX8SpI01QaWogce3vne1COBzCtWvXMTo6irGxMUxMTAhMTk5ifHxc6IPBIH77+SZ+HPkGP418jV++G8HNb79C8Ifvcam9HeV07xLfVf/HV8BrZnYWs4RIJIKdnR0BXvPz81hYWBD76MzfuDUZxO1wGNOUxF9//I75f+7gi85OqOjVpcJiE3r6AsJ5ZWUFoVAIm5ub2Nrawvr6OlKpFKLRKGJra0im0rg/9y/u3wohPnMbf964jnvBX4HIHfSf7aSXrsonXFpawvT0tCBjUiZMJpNYI7JYLCb26xv0ZwnKPp3CPfKP0ZnXeeLgr0Xin97+T4VyeXkZU1NTSKfTotzt7W2hj8fj2NzYEHv+s51EAuSEu3NziMfiQt/Ty4SWDKG/N5Ph4uIiPU5YZLdBBEzEWa2uroqyec86tiWIlO86Gl0TsRd6LtG3+ICwp+8ToeTASOSuyGx3yUyS3bNkGxPynbNNEH5IhNkMez/6TCiZiEvixQEMXskkv3gi55N9fbZnr4WTEiWrdU7qgEY0n2xH6+vv4Mzb7+OV5jYcbzmNphNvCrkbWR1LjuF9S+sZ1BCHWkfjS2/2Un8Ss0xDreOC9+DL2CNTQ1ZooB7VU88+hEzAIGx7Htegzv0iDZEaPPYE976FhoOXhoPJQ9PFRtPDDrXeRQ1+gM7VwrG43PFIlFQ4hE9DYwvNQJ+IV6hsYC7JYDkgmBlao0eAs9aSMaPfLT05X4aGEmD/7Nlg8eE/RKdtFJKaPRUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 2' title='' src='/static/814dd7f0b1d91e8a8f1ccd73e462a77b/ca1dc/image-2.png' srcset='/static/814dd7f0b1d91e8a8f1ccd73e462a77b/e7570/image-2.png 170w,\n/static/814dd7f0b1d91e8a8f1ccd73e462a77b/f46e7/image-2.png 340w,\n/static/814dd7f0b1d91e8a8f1ccd73e462a77b/ca1dc/image-2.png 680w,\n/static/814dd7f0b1d91e8a8f1ccd73e462a77b/c852c/image-2.png 784w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>그렇기 때문에 이 프라이머리 키를 포함한 조회 쿼리도 충분히 커버링 인덱스로 활용이 가능하다.</p>\n<h2>References.</h2>\n<p>백은빈, 이성욱, 『Real MySQL 8.0』, 위키북스(2021), p476 ~ 479</p>","frontmatter":{"title":"커버링 인덱스","date":"October 10, 2022","update":"October 10, 2022","tags":["우아한테크코스","커버링 인덱스"],"series":null},"fields":{"slug":"/covering-index/","readingTime":{"minutes":7.41}}},"seriesList":{"edges":[{"node":{"id":"984809e6-d465-5dfd-9c59-579d12581fac","fields":{"slug":"/immutable-object/"},"frontmatter":{"title":"불변 객체"}}},{"node":{"id":"fa92531f-b76e-587c-a42b-14dedd6e2cb1","fields":{"slug":"/first-class-collection/"},"frontmatter":{"title":"일급 컬렉션"}}},{"node":{"id":"2dac6856-47a1-5ef0-9c9f-d69d4234afcf","fields":{"slug":"/why-jdbc-template/"},"frontmatter":{"title":"JdbcTemplate는 어디에?"}}},{"node":{"id":"ab71a72e-f8d9-55e6-bdd4-66e8778b0b67","fields":{"slug":"/enum/"},"frontmatter":{"title":"enum"}}},{"node":{"id":"b77737b7-c888-54d0-8901-9921b4bbb703","fields":{"slug":"/spring-jdbc-batch/"},"frontmatter":{"title":"Spring JDBC로 batch 활용하기"}}},{"node":{"id":"59e94329-3d48-53b9-9995-90d61432234d","fields":{"slug":"/local-date-time/"},"frontmatter":{"title":"java에서 날짜, 시간 제대로 사용하기"}}},{"node":{"id":"c8dda97d-41c7-5596-a0c8-703fd69d92e7","fields":{"slug":"/identity-strategy/"},"frontmatter":{"title":"IDENTITY 전략는 추가 조회를 하지 않을 수 있다."}}},{"node":{"id":"c50af7e8-5953-5168-b4af-1d186a4254a7","fields":{"slug":"/separated-interface/"},"frontmatter":{"title":"외부와 의존성 분리하기"}}},{"node":{"id":"ba9d009e-d6e8-574f-9f7b-89819e3e57ca","fields":{"slug":"/properties-to-object/"},"frontmatter":{"title":"properties 객체로 다루기"}}},{"node":{"id":"7b780208-a850-5305-a51c-f0937cbdaf93","fields":{"slug":"/google-refresh-token/"},"frontmatter":{"title":"Google은 Refresh Token을 쉽게 내주지 않는다."}}},{"node":{"id":"b886feb1-ab24-59f0-8972-2d2b510ea407","fields":{"slug":"/mappedsuperclass-vs-embedded/"},"frontmatter":{"title":"@MappedSuperclass vs @Embedded"}}},{"node":{"id":"58f32f4d-b2d6-54d6-b3dd-cb4cf4da1d70","fields":{"slug":"/basic-tomcat/"},"frontmatter":{"title":"Tomcat"}}},{"node":{"id":"d26e840e-0646-5dd9-a2d5-5670ddc81ede","fields":{"slug":"/jdbc/"},"frontmatter":{"title":"JDBC"}}},{"node":{"id":"e0a32367-096e-595a-9580-0d3d2fc6e9aa","fields":{"slug":"/template-callback/"},"frontmatter":{"title":"jdbcTemplate을 만들며 마주한 Template Callback 패턴"}}},{"node":{"id":"fa938264-2615-556e-bcfa-d749c30aa8fe","fields":{"slug":"/covering-index/"},"frontmatter":{"title":"커버링 인덱스"}}},{"node":{"id":"cf3a2936-1b1f-5d11-832e-dbb9f8051755","fields":{"slug":"/osiv/"},"frontmatter":{"title":"OSIV와 사용하며 직면한 문제"}}},{"node":{"id":"53859931-2807-5303-a90d-33df33a856de","fields":{"slug":"/save-persist-merge/"},"frontmatter":{"title":"SimpleJpaRepository의 save()는 어떻게 새로운 엔티티를 판단할까?"}}},{"node":{"id":"09a96ca9-bb95-55ab-83cf-d9d053b2ad70","fields":{"slug":"/optimistic-locking/"},"frontmatter":{"title":"낙관적 락과 동시성 테스트"}}},{"node":{"id":"647737e4-08ec-5813-a092-c27ef1da4292","fields":{"slug":"/java-string/"},"frontmatter":{"title":"문자열 생성 방식 비교하기"}}},{"node":{"id":"696ee6ba-c2ea-5e8b-a25f-aaa4eccfa5e9","fields":{"slug":"/2022-retrospect/"},"frontmatter":{"title":"조금 늦은 2022년 회고"}}},{"node":{"id":"5a61e41a-16ff-5669-bf0e-028ea40e0af3","fields":{"slug":"/jpa-auditing/"},"frontmatter":{"title":"Spring Data JPA Auditing"}}},{"node":{"id":"b3a293eb-b729-53e0-ac2b-5f1ec784c320","fields":{"slug":"/testcontainers/"},"frontmatter":{"title":"testcontainers"}}}]},"previous":{"fields":{"slug":"/template-callback/"},"frontmatter":{"title":"jdbcTemplate을 만들며 마주한 Template Callback 패턴"}},"next":{"fields":{"slug":"/osiv/"},"frontmatter":{"title":"OSIV와 사용하며 직면한 문제"}}},"pageContext":{"id":"fa938264-2615-556e-bcfa-d749c30aa8fe","series":null,"previousPostId":"e0a32367-096e-595a-9580-0d3d2fc6e9aa","nextPostId":"cf3a2936-1b1f-5d11-832e-dbb9f8051755"}},"staticQueryHashes":[],"slicesMap":{}}