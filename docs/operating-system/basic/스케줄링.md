---
title: CPU scheduling
tags: ['os', 'scheduling']
---

# scheduling

메모리에 적재된 프로그램을 CPU가 실행할 수 있도록 os가 프로세스 또는 스레드에 CPU를 할당하는 것을 스케줄링이라고 한다. 스케줄러는 한정된 자원을 여러 프로세스가 효율적으로 사용할 수 있도록 다양한 정책으로 CPU를 할당한다. 

::: tip
프로세스 스케줄링과 스레드 스케줄링은 할당 대상이 다를 뿐 동작 방식은 동일하다. 아래 설명은 모두 프로세스 스케줄링을 기준으로 한다.
:::

## 스케줄링의 목적

 * 자원 할당의 공정성을 보장한다.
 * 단위 시간당 처리량을 최대로 한다.
 * 적절한 반환 시간을 보장한다.
 * 예측 가능성을 보장한다.
 * 오버헤드를 최소화 한다.
 * 자원 사용의 균형을 유지한다.
 * 실행을 무한 연기 하지 않도록 한다.
 * 우선순위가 높은 프로세스를 먼저 실행하도록 한다.
 * 프로세스에게 더 자주 서비스 사용 기회를 제공한다.
 * 서비스가 갑자기 감소하지 않게 과부하에 대처해야 한다.

## 비선점과 선점

`스케줄링`에는 크게 `비선점(non-preemtive) 방식`과 `선점(preemtive) 방식`으로 나뉜다. `비선점 방식`은 현재 프로세스가 CPU를 자진 반납할 때까지 CPU에 의한 실행을 보장한다. `선점 방식`은 현재 프로세스보다 높은 우선순위의 프로세스가 나타나는 경우 `강제`로 CPU를 `회수`한다. 

스케줄링 대상은 `준비 큐(Ready Queue)`에 있는 프로세스이다.

### 비선점형 스케줄링

#### FCFS(First Come First Served)
 * 먼저 온 고객에게 먼저 서비스를 하듯 먼저 온 순서대로 CPU를 할당한다.
 * CPU가 할당되면 완료될 때 까지 반환하지 않는다. 
 * 소요 시간이 긴 작업이 먼저 도달한 경우 여러 개의 짧은 작업이 기다릴 수 있다. 이것을 `호위 효과(convoy effect)`라 부른다.

#### SJF (Shortest Job First)
 * 작업 시간이 짧은 프로세스에게 먼저 할당한다.
 * 준비 큐가 비어있는 경우 작업 시간이 더 긴 프로세스가 먼저 할당될 수 있다. 또한 현재 실행 중인 작업을 중단하고 할당하는 것은 아니다. 
 * 작업 시간이 동일할 경우 먼저 도착한 것을 우선적으로 처리한다.
 * 이 방식은 CPU 사용이 짧은 작업을 선호한다. 특정 프로세스가 지나치게 차별받을 수 있으며 사용 시간이 긴 프로세스는 영원히 CPU를 할당받지 못할 수도 있다.

#### 비선점 우선순위 스케줄링 (Priority Scheduling)
 * 프로세스가 자체적인 우선순위를 두고 `우선순위가 가장 높은 프로세스`에게 CPU를 할당한다. 우선순위가 같은 경우 FCFS로 처리된다.
 * SJF도 일반적인 우선순위 스케줄링의 특별한 경우로 볼 수 있다.
 * `비선점 우선순위 큐`의 경우 단순히 준비 큐의 머리 부분에 새로운 프로세스를 넣는다.
 * 높은 우선순위 프로세스가 CPU를 많이 사용하면 우선순위가 낮은 CPU는 무한정 연기되어 `기아 상태(starvation)`가 발생할 수 있다.
 * 우선순위가 낮은 프로세스는 오래 기다리면 우선순위를 높일 수 있도록 처리하여 해결할 수 있다(aging).

#### HRN Highest Response-ratio Next
 * SJF의 약점이었던 긴 잡억과 짧은 작업 간의 불평등을 해소하기 위해 등장하였다.
 * 우선순위 스케줄링의 또 다른 예로 FCFS와 SJF의 약점 해결을 위해 등장하였다.
 * `우선순위 = 서비스를 받을 시간 + 대기 시간 / 서비스를 받을 시간` 

### 선점 스케줄링

#### SRTF (Shortest Remaining Time First)
 * 새로운 프로세스가 도착할 때 마다 새로운 스케줄링이 이루어진다.
 * 현재 실행중인 프로세스의 남은 시간 보다 더 짧은 시간을 가지는 새로운 프로세스가 도착하면 실행권을 회수한 뒤 선점한다.

#### 선점 우선순위 스케줄링
 * 방식은 위에서 언급한 우선순위 스케줄링과 동일하다.
 * 우선순위가 더 높은 프로세스가 추가될 경우 현재 실행 중인 프로세스의 실행권을 `회수`한 뒤 선점한다.

#### 라운드 로빈 스케줄링 (Round Robin Scheduling)
 * 준비 큐를 원형 큐로 간주하고 순환하며 작은 단위의 시간인 규정 시간량(time quantum)만큼 CPU를 할당한다.
 * 새로운 프로세스가 추가되면 준비 큐의 맨 위에 추가된다.
 * 모든 프로세스가 공정하게 기회를 얻게 되기 때문에 기아상태가 발생하지 않는다.
 * 규정 시간량의 크기에 따라 성능에 큰 영향을 미친다. 너무 커지면 FCFS와 유사해진다. 너무 작아지면 잦은 문맥교환에 의해 오버 헤드가 커져 처리율이 감소한다.

## References

[[운영체제] 비선점 스케줄링과 선점 스케줄링](https://inuplace.tistory.com/318)<br>
[CPU 스케줄러](https://github.com/JaeYeopHan/Interview_Question_for_Beginner/blob/master/OS/README.md#cpu-%EC%8A%A4%EC%BC%80%EC%A4%84%EB%9F%AC)

<TagLinks />