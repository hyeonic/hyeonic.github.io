(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{426:function(t,s,a){t.exports=a.p+"assets/img/1.c53efa5a.png"},427:function(t,s,a){t.exports=a.p+"assets/img/2.47021bc8.png"},428:function(t,s,a){t.exports=a.p+"assets/img/3.a38b5970.png"},429:function(t,s,a){t.exports=a.p+"assets/img/4.dd11e9d6.png"},430:function(t,s,a){t.exports=a.p+"assets/img/5.95ff659b.png"},697:function(t,s,a){"use strict";a.r(s);var n=a(21),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"ğŸš—-á„á…¡á„€á…³á†«á„á…¡á„€á…³á†«-á„ƒá…©á†¼á„‰á…µá„‰á…¥á†¼-á„‹á…µá„‰á…²-á„’á…¢á„€á…§á†¯á„’á…¡á„€á…µ-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ğŸš—-á„á…¡á„€á…³á†«á„á…¡á„€á…³á†«-á„ƒá…©á†¼á„‰á…µá„‰á…¥á†¼-á„‹á…µá„‰á…²-á„’á…¢á„€á…§á†¯á„’á…¡á„€á…µ-2"}},[t._v("#")]),t._v(" ğŸš— ì°¨ê·¼ì°¨ê·¼ ë™ì‹œì„± ì´ìŠˆ í•´ê²°í•˜ê¸° (2)")]),t._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://hyeonic.github.io/spring/concurrency/concurrency-1.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸš— ì°¨ê·¼ì°¨ê·¼ ë™ì‹œì„± ì´ìŠˆ í•´ê²°í•˜ê¸° (1) - synchronized"),n("OutboundLink")],1),t._v(" "),n("br"),t._v("\nğŸ‘‰ "),n("a",{attrs:{href:"https://hyeonic.github.io/spring/concurrency/concurrency-2.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸš— ì°¨ê·¼ì°¨ê·¼ ë™ì‹œì„± ì´ìŠˆ í•´ê²°í•˜ê¸° (2) - Pessimistic Lock"),n("OutboundLink")],1),t._v(" "),n("br"),t._v(" "),n("a",{attrs:{href:"https://hyeonic.github.io/spring/concurrency/concurrency-3.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸš— ì°¨ê·¼ì°¨ê·¼ ë™ì‹œì„± ì´ìŠˆ í•´ê²°í•˜ê¸° (3) - Optimistic Lock"),n("OutboundLink")],1),t._v(" "),n("br"),t._v(" "),n("a",{attrs:{href:"https://hyeonic.github.io/spring/concurrency/concurrency-4.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ğŸš— ì°¨ê·¼ì°¨ê·¼ ë™ì‹œì„± ì´ìŠˆ í•´ê²°í•˜ê¸° (4) - Named Lock"),n("OutboundLink")],1),t._v(" "),n("br")])]),t._v(" "),n("blockquote",[n("p",[t._v("ì‘ì„±ì— ì‚¬ìš©ëœ ì˜ˆì œ ì½”ë“œëŠ” "),n("a",{attrs:{href:"https://github.com/hyeonic/blog-code/tree/main/concurrency-pessimistic-lock",target:"_blank",rel:"noopener noreferrer"}},[t._v("concurrency-pessimistic-lock"),n("OutboundLink")],1),t._v("ì—ì„œ í™•ì¸í•´ë³¼ ìˆ˜ ìˆë‹¤.")])]),t._v(" "),n("h2",{attrs:{id:"á„‡á…µá„€á…ªá†«á„Œá…¥á†¨-á„…á…¡á†¨"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#á„‡á…µá„€á…ªá†«á„Œá…¥á†¨-á„…á…¡á†¨"}},[t._v("#")]),t._v(" ë¹„ê´€ì  ë½")]),t._v(" "),n("p",[t._v("ë¹„ê´€ì  ë½ì´ë€, íŠ¸ëœì­ì…˜ ì‚¬ì´ì— ì¶©ëŒì´ ë°œìƒí•  ê²ƒì„ì„ "),n("code",[t._v("ë¹„ê´€ì ")]),t._v("ìœ¼ë¡œ ê°€ì •í•œ ë’¤ ë½ì„ ê±°ëŠ” ë°©ì‹ì„ ë§í•œë‹¤. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ë½ ê¸°ëŠ¥ì„ í™œìš©í•œë‹¤.")]),t._v(" "),n("p",[t._v("íŠ¹ì • íŠ¸ëœì­ì…˜ì—ì„œ "),n("code",[t._v("x-lock")]),t._v("ì„ íšë“í•˜ê²Œ ë˜ë©´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œëŠ” ë½ì´ í•´ì œë  ë•Œ ê¹Œì§€ ëŒ€ê¸°í•˜ê²Œ ëœë‹¤.")]),t._v(" "),n("h2",{attrs:{id:"á„‹á…¨á„Œá…¦-á„á…©á„ƒá…³"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#á„‹á…¨á„Œá…¦-á„á…©á„ƒá…³"}},[t._v("#")]),t._v(" ì˜ˆì œ ì½”ë“œ")]),t._v(" "),n("p",[t._v("ì˜ˆì œ ì½”ë“œëŠ” ì´ì „ì— "),n("code",[t._v("synchronized")]),t._v("ë¥¼ í™œìš©í•œ ë™ì‹œì„± ì´ìŠˆ í•´ê²°ì—ì„œ ì‚¬ìš©í•œ Product ì—”í‹°í‹°ë¥¼ ì¬ì‚¬ìš©í•  ê²ƒì´ë‹¤. ì¶”ê°€ëœ ë¶€ë¶„ì€ "),n("code",[t._v("x-lock")]),t._v("ì„ ê±´ ë’¤ ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œê°€ ì¶”ê°€ ë˜ì—ˆë‹¤.")]),t._v(" "),n("p",[t._v("MySQLì€ ê°€ì¥ ìµœì‹  ë²„ì „ì¸ "),n("code",[t._v("8.0.30")]),t._v("ì„ í™œìš© í–ˆìœ¼ë©° ê¸°ë³¸ ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì¸ "),n("code",[t._v("InnoDB")]),t._v("ë¥¼ ì‚¬ìš© í–ˆë‹¤.")]),t._v(" "),n("h2",{attrs:{id:"á„‡á…µá„€á…ªá†«á„Œá…¥á†¨-á„…á…¡á†¨-á„Œá…¥á†¨á„‹á…­á†¼"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#á„‡á…µá„€á…ªá†«á„Œá…¥á†¨-á„…á…¡á†¨-á„Œá…¥á†¨á„‹á…­á†¼"}},[t._v("#")]),t._v(" ë¹„ê´€ì  ë½ ì ìš©")]),t._v(" "),n("p",[t._v("ë¹„ê´€ì  ë½ ì ìš©ì€ "),n("code",[t._v("@Lock")]),t._v(" ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ ì‰½ê²Œ ì ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductRepository")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JpaRepository")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Lock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockModeType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PESSIMISTIC_WRITE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT p FROM Product p WHERE p.id = :id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Optional")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findByIdWithPessimisticLock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("@Lock(value = LockModeType.PESSIMISTIC_WRITE)")]),t._v("ì„ ì ìš©í•œ ë’¤ ìœ„ ë©”ì„œë“œë¥¼ ìˆ˜í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì¿¼ë¦¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.")]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" id1_0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" name2_0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("quantity "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" quantity3_0_\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" product product0_\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ? "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),t._v("\n")])])]),n("p",[n("code",[t._v("for update")]),t._v("ë€ í‚¤ì›Œë“œê°€ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì´ê²ƒì´ ì˜ë¯¸í•˜ëŠ” ë°”ëŠ” ì¡°íšŒí•˜ëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ "),n("code",[t._v("x-lock")]),t._v("ì„ ê±¸ì—ˆë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œëŠ” í•´ì œë  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦¬ê²Œ ëœë‹¤.")]),t._v(" "),n("p",[t._v("ì•„ë˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ìˆ˜í–‰í•´ë³´ë©´ ì •ìƒì ìœ¼ë¡œ í†µê³¼í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootTest")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@DisplayNameGeneration")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReplaceUnderscores")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductServiceTest")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" ë™ì‹œì—_100ê°œì˜_ìƒí’ˆì„_êµ¬ë§¤í•œë‹¤"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" product "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" productRepository"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ì¹˜í‚¨"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100L")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" executorService "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("newFixedThreadPool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" countDownLatch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            executorService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("submit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("process")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" countDownLatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        countDownLatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" actual "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" productRepository"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("orElseThrow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("assertThat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("actual"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getQuantity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEqualTo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0L")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("process")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),t._v(" product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),t._v(" countDownLatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            productService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("purchase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1L")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            countDownLatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("countDown")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(426),alt:"img.png"}})]),t._v(" "),n("p",[t._v("ì´ ë°©ì‹ì— ê°€ì¥ í° ì¥ì ì€ ì¶©ëŒì´ ë¹ˆë²ˆí•˜ê²Œ ì¼ì–´ë‚˜ëŠ” ìƒí™©ì—ì„œ ë°ì´í„°ì˜ ì •í•©ì„±ì„ ì ì ˆí•˜ê²Œ ì§€í‚¬ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ë‹¨ì ìœ¼ë¡œëŠ” ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ë½ì„ ê±¸ê¸° ë•Œë¬¸ì— ë‹¤ìˆ˜ì˜ ìš”ì²­ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•˜ì§€ ëª»í•œë‹¤.")]),t._v(" "),n("h2",{attrs:{id:"lock"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lock"}},[t._v("#")]),t._v(" @Lock")]),t._v(" "),n("p",[n("code",[t._v("@Lock")]),t._v(" ì• ë…¸í…Œì´ì…˜ì€ íŠ¸ëœì­ì…˜ ë²”ìœ„ ë‚´ì—ì„œë§Œ ìœ íš¨í•˜ë‹¤. ë¹„ê´€ì  ë½ì„ ê±¸ê¸° ìœ„í•œ "),n("code",[t._v("LockModeType")]),t._v("ì€ 3 ê°€ì§€ê°€ ì¡´ì¬í•œë‹¤.")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("PESSIMISTIC_READ")]),t._v(": "),n("code",[t._v("s-lock")]),t._v("ì„ ê±´ë‹¤.")]),t._v(" "),n("li",[n("code",[t._v("PESSIMISTIC_WRITE")]),t._v(": "),n("code",[t._v("x-lock")]),t._v("ì„ ê±´ë‹¤. ì•ì„œ ë™ì‹œì„± ì´ìŠˆ í•´ê²°ì„ ìœ„í•´ ì ìš©í•œ "),n("code",[t._v("LockModeType")]),t._v("ì´ë‹¤.")]),t._v(" "),n("li",[n("code",[t._v("PESSIMISTIC_FORCE_INCREMENT")]),t._v(": ë²„ì „ ì—…ë°ì´íŠ¸ì™€ í•¨ê»˜ "),n("code",[t._v("x-lock")]),t._v("ì„ ìˆ˜í–‰í•œë‹¤. version ì¹¼ëŸ¼ì´ ì¶”ê°€ì ìœ¼ë¡œ í•„ìš”í•œ ê²ƒìœ¼ë¡œ íŒë‹¨ë˜ëŠ”ë° ìì„¸í•œ ì‚¬ìš© ì˜ˆì‹œëŠ” ì•„ì§ ë– ì˜¤ë¥´ì§€ ì•ŠëŠ”ë‹¤.")])]),t._v(" "),n("p",[n("code",[t._v("@Lock(value = LockModeType.PESSIMISTIC_READ)")]),t._v(", "),n("code",[t._v("s-lock")]),t._v("ì„ í™œìš©í•  ê²½ìš° ì•„ë˜ì™€ ê°™ì€ ì¿¼ë¦¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.")]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" id1_0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" name2_0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("quantity "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" quantity3_0_\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" product product0_\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ? "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("share")]),t._v("\n")])])]),n("p",[n("code",[t._v("for share")]),t._v("ëŠ” "),n("code",[t._v("s-lock")]),t._v("ìœ¼ë¡œ, íŠ¸ëœì­ì…˜ì´ ëë‚  ë•Œ ê¹Œì§€ ì¡°íšŒí•œ ë ˆì½”ë“œê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤. í•´ë‹¹ ë ˆì½”ë“œë¥¼ ìˆ˜ì •í•˜ë ¤ëŠ” ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì€ ë½ì´ í•´ì œë  ë•Œ ê¹Œì§€ ëŒ€ê¸°í•˜ê²Œ ëœë‹¤. ë‹¤ë§Œ "),n("code",[t._v("s-lock")]),t._v("\nì´ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì—ì„œ "),n("code",[t._v("ì¡°íšŒ")]),t._v("ëŠ” ê°€ëŠ¥í•˜ë‹¤.")]),t._v(" "),n("p",[t._v("ì´ëŸ¬í•œ íŠ¹ì„± ë•Œë¬¸ì— "),n("code",[t._v("êµì°©ìƒíƒœ(deadlock)")]),t._v("ì— ë¹ ì§ˆ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤. ê´€ë ¨ ì‚¬ë¡€ëŠ”\n"),n("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-deadlock-example.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("15.7.5.1 An InnoDB Deadlock Example"),n("OutboundLink")],1),t._v("ì— ì˜ ì„¤ëª…ë˜ì–´ ìˆë‹¤.")]),t._v(" "),n("p",[t._v("ê°„ë‹¨í•œ ì˜ˆì‹œë¥¼ ë“¤ì–´ë³´ë©´ ë‘ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— "),n("code",[t._v("s-lock")]),t._v("ì„ í†µí•´ ë ˆì½”ë“œë¥¼ ì¡°íšŒ í–ˆë‹¤ê³  ê°€ì •í•œë‹¤. ë‘ íŠ¸ëœì­ì…˜ì€ ì¡°íšŒëœ ë ˆì½”ë“œë¥¼ "),n("code",[t._v("UPDATE")]),t._v("í•œë‹¤. "),n("code",[t._v("UPDATE")]),t._v("ë‚˜ "),n("code",[t._v("DELETE")]),t._v("ë¥¼ ìœ„í•´ì„œëŠ” "),n("code",[t._v("x-lock")]),t._v("ì´\ní•„ìš”í•˜ë‹¤. ë‘ íŠ¸ëœì­ì…˜ì€ ì„œë¡œ "),n("code",[t._v("x-lock")]),t._v("ì„ íšë“í•˜ê¸° ìœ„í•´ "),n("code",[t._v("s-lock")]),t._v("ì´ í•´ì œë  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. ê²°êµ­ ë‘ íŠ¸ëœì­ì…˜ ëª¨ë‘ "),n("code",[t._v("x-lock")]),t._v("ì„ íšë“í•˜ì§€ ëª»í•œ ì±„ "),n("code",[t._v("deadlock")]),t._v("ì´ ë°œìƒí•œë‹¤.")]),t._v(" "),n("p",[t._v("ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(427),alt:"img.png"}})]),t._v(" "),n("p",[t._v("ì¡°íšŒ ë©”ì„œë“œë¥¼ "),n("code",[t._v("@Lock(value = LockModeType.PESSIMISTIC_READ)")]),t._v("ìœ¼ë¡œ ìˆ˜ì •í•œ ë’¤ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ë©´ "),n("code",[t._v("ERROR log")]),t._v("ì™€ í•¨ê»˜ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•œë‹¤.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductRepository")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JpaRepository")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Lock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockModeType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PESSIMISTIC_READ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT p FROM Product p WHERE p.id = :id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Optional")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findByIdWithPessimisticLock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-12-12 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":56:50.399  WARN "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("96139")]),t._v(" --- "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ool-1-thread-10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" o.h.engine.jdbc.spi.SqlExceptionHelper   "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" SQL Error: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1213")]),t._v(", SQLState: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("40001")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-12-12 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":56:50.402 ERROR "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("96139")]),t._v(" --- "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("pool-1-thread-2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" o.h.engine.jdbc.spi.SqlExceptionHelper   "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" Deadlock found when trying to get lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" try restarting transaction\n")])])]),n("p",[n("img",{attrs:{src:a(428),alt:"img.png"}})]),t._v(" "),n("h2",{attrs:{id:"á„‡á…¥á†«á„‹á…¬-á„Œá…©á„’á…¬-á„‹á…¥á†¹á„‹á…µ-á„‡á…¡á„…á…©-update"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#á„‡á…¥á†«á„‹á…¬-á„Œá…©á„’á…¬-á„‹á…¥á†¹á„‹á…µ-á„‡á…¡á„…á…©-update"}},[t._v("#")]),t._v(" [ë²ˆì™¸] ì¡°íšŒ ì—†ì´ ë°”ë¡œ UPDATE")]),t._v(" "),n("p",[t._v("ì˜ˆì œë¥¼ ì‘ì„±í•˜ë˜ ì¤‘ ë³µì¡í•˜ì§€ ì•Šì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì¸ë° "),n("code",[t._v("for update")]),t._v("ë¥¼ í†µí•´ ì¡°íšŒí•˜ì§€ ì•Šê³  ë°”ë¡œ "),n("code",[t._v("UPDATE")]),t._v("ë¥¼ ì§„í–‰í•´ë„ ë˜ì§€ ì•Šì„ê¹Œë¼ëŠ” ì˜ë¬¸ì´ ìƒê²¼ë‹¤. ê°€ë ¹ ì•„ë˜ì™€ ê°™ì´ ë§ì´ë‹¤.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductRepository")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JpaRepository")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Modifying")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE Product p "')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SET p.quantity = p.quantity - :quantity "')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WHERE p.id = :id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decreaseQuantity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" quantity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductService")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Transactional")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("purchase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" quantity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        productRepository"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decreaseQuantity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("quantity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("ì¿¼ë¦¬ë¥¼ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.")]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),t._v(" product\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" quantity "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" quantity "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" ?\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" id "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ?\n")])])]),n("p",[t._v("ì‹¤ì œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•´ë„ í†µê³¼í•œë‹¤.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(429),alt:"img.png"}})]),t._v(" "),n("p",[t._v("ë‹¤ë§Œ ë¬´ì¡°ê±´ ìš”ì²­ì´ 100ë²ˆë§Œ ì˜¨ë‹¤ëŠ” ë³´ì¥ì´ ì—†ê¸° ë•Œë¬¸ì— ìˆ˜ëŸ‰ ë³´ë‹¤ ë§ì€ ìš”ì²­ì´ ë“¤ì–´ì˜¨ë‹¤ê³  ê°€ì •í•œ ë’¤ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆë‹¤.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(430),alt:"img.png"}})]),t._v(" "),n("p",[t._v("ì¿¼ë¦¬ì— ìˆ˜ëŸ‰ì— ëŒ€í•œ ì¡°ê±´ì´ ì—†ê¸° ë•Œë¬¸ì— ìš°ë¦¬ê°€ ìš”êµ¬ì‚¬í•­ì´ ë§Œì¡±í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ë•Œ ì¿¼ë¦¬ì— ìˆ˜ëŸ‰ì— ëŒ€í•œ ì¡°ê±´ì„ ì¶”ê°€í•œë‹¤.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductRepository")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JpaRepository")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Modifying")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE Product p "')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SET p.quantity = p.quantity - :quantity "')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WHERE p.id = :id AND p.quantity > 0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decreaseQuantity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" quantity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("ìœ„ ì¿¼ë¦¬ëŠ” í•œ ë²ˆì— ìš”êµ¬ì‚¬í•­ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ ë°ì´í„°ë² ì´ìŠ¤ì— êµ‰ì¥íˆ ì¢…ì†ì ì¸ ë°©ë²•ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤. ê¸°ì¡´ ë°©ë²•ì¸ "),n("code",[t._v("x-lock")]),t._v("ì„ í†µí•œ ì¡°íšŒ ì´í›„ "),n("code",[t._v("UPDATE")]),t._v("ë¥¼ ìˆ˜í–‰í•  ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ ì œì•½ ì¡°ê±´ì„\ní™•ì¸í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤. ê° ìƒí™©ì— ë§ì¶°ì„œ ì ì ˆí•œ ë°©ë²•ì„ ì„ íƒí•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.")]),t._v(" "),n("h2",{attrs:{id:"á„Œá…¥á†¼á„…á…µ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#á„Œá…¥á†¼á„…á…µ"}},[t._v("#")]),t._v(" ì •ë¦¬")]),t._v(" "),n("p",[t._v("ì§€ê¸ˆê¹Œì§€ ë¹„ê´€ì  ë½ì„ í™œìš©í•œ ë™ì‹œì„± ì´ìŠˆ í•´ê²° ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ë‹¤. ë¹„ê´€ì  ë½ì€ ê³µìœ  ìì›ì¸ ë°ì´í„°ë² ì´ìŠ¤ì— ë½ì„ ê±¸ì–´ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ë§Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ìƒí˜¸ë°°ì œë¥¼ ë‹¬ì„±í•œë‹¤. ë‹¤ì¤‘ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì™€ ë‹¨ì¼\në°ì´í„°ë² ì´ìŠ¤ì˜ ê²½ìš° ì´ëŸ¬í•œ ë°©ì‹ì€ ë™ì‹œì„± ì´ìŠˆì— ëŒ€í•œ ë¹ ë¥¸ í•´ê²°ì±…ì´ ë  ìˆ˜ ìˆë‹¤.")]),t._v(" "),n("p",[t._v("í•˜ì§€ë§Œ ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ ë½ì„ ê±¸ê¸° ë•Œë¬¸ì— ë½ì´ ê±¸ë¦° ìì›ì— ì ‘ê·¼í•˜ëŠ” íŠ¸ëœì­ì…˜ì€ ëŒ€ê¸°í•˜ê²Œ ëœë‹¤. íŠ¸ëœì­ì…˜ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ëŒ€ê¸°í•˜ëŠ” ì‹œê°„ì„ ê¸¸ì–´ì§ˆ ê²ƒì´ë‹¤. ì¦‰ ì„±ëŠ¥ ìƒì— ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤.")]),t._v(" "),n("p",[t._v("ë‹¤ìŒ ì‹œê°„ì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ ë½ì„ ê±¸ì§€ ì•Šê³  versionì´ë¼ëŠ” ì¶”ê°€ì ì¸ ì¹¼ëŸ¼ì„ í†µí•´ ë™ì‹œì„± ì´ìŠˆë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³¼ ì˜ˆì •ì´ë‹¤.")]),t._v(" "),n("h2",{attrs:{id:"references"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References.")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-deadlock-example.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("15.7.5.1 An InnoDB Deadlock Example"),n("OutboundLink")],1),n("br"),t._v(" "),n("a",{attrs:{href:"https://www.inflearn.com/course/%EB%8F%99%EC%8B%9C%EC%84%B1%EC%9D%B4%EC%8A%88-%EC%9E%AC%EA%B3%A0%EC%8B%9C%EC%8A%A4%ED%85%9C",target:"_blank",rel:"noopener noreferrer"}},[t._v("ì¬ê³ ì‹œìŠ¤í…œìœ¼ë¡œ ì•Œì•„ë³´ëŠ” ë™ì‹œì„±ì´ìŠˆ í•´ê²°ë°©ë²•"),n("OutboundLink")],1)]),t._v(" "),n("TagLinks")],1)}),[],!1,null,null,null);s.default=e.exports}}]);