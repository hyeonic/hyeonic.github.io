(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{426:function(t,s,a){t.exports=a.p+"assets/img/1.c53efa5a.png"},427:function(t,s,a){t.exports=a.p+"assets/img/2.47021bc8.png"},428:function(t,s,a){t.exports=a.p+"assets/img/3.a38b5970.png"},429:function(t,s,a){t.exports=a.p+"assets/img/4.dd11e9d6.png"},430:function(t,s,a){t.exports=a.p+"assets/img/5.95ff659b.png"},697:function(t,s,a){"use strict";a.r(s);var n=a(21),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"🚗-차근차근-동시성-이슈-해결하기-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#🚗-차근차근-동시성-이슈-해결하기-2"}},[t._v("#")]),t._v(" 🚗 차근차근 동시성 이슈 해결하기 (2)")]),t._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://hyeonic.github.io/spring/concurrency/concurrency-1.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("🚗 차근차근 동시성 이슈 해결하기 (1) - synchronized"),n("OutboundLink")],1),t._v(" "),n("br"),t._v("\n👉 "),n("a",{attrs:{href:"https://hyeonic.github.io/spring/concurrency/concurrency-2.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("🚗 차근차근 동시성 이슈 해결하기 (2) - Pessimistic Lock"),n("OutboundLink")],1),t._v(" "),n("br"),t._v(" "),n("a",{attrs:{href:"https://hyeonic.github.io/spring/concurrency/concurrency-3.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("🚗 차근차근 동시성 이슈 해결하기 (3) - Optimistic Lock"),n("OutboundLink")],1),t._v(" "),n("br"),t._v(" "),n("a",{attrs:{href:"https://hyeonic.github.io/spring/concurrency/concurrency-4.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("🚗 차근차근 동시성 이슈 해결하기 (4) - Named Lock"),n("OutboundLink")],1),t._v(" "),n("br")])]),t._v(" "),n("blockquote",[n("p",[t._v("작성에 사용된 예제 코드는 "),n("a",{attrs:{href:"https://github.com/hyeonic/blog-code/tree/main/concurrency-pessimistic-lock",target:"_blank",rel:"noopener noreferrer"}},[t._v("concurrency-pessimistic-lock"),n("OutboundLink")],1),t._v("에서 확인해볼 수 있다.")])]),t._v(" "),n("h2",{attrs:{id:"비관적-락"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#비관적-락"}},[t._v("#")]),t._v(" 비관적 락")]),t._v(" "),n("p",[t._v("비관적 락이란, 트랜잭션 사이에 충돌이 발생할 것임을 "),n("code",[t._v("비관적")]),t._v("으로 가정한 뒤 락을 거는 방식을 말한다. 데이터베이스에서 제공하는 락 기능을 활용한다.")]),t._v(" "),n("p",[t._v("특정 트랜잭션에서 "),n("code",[t._v("x-lock")]),t._v("을 획득하게 되면 다른 트랜잭션에서는 락이 해제될 때 까지 대기하게 된다.")]),t._v(" "),n("h2",{attrs:{id:"예제-코드"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#예제-코드"}},[t._v("#")]),t._v(" 예제 코드")]),t._v(" "),n("p",[t._v("예제 코드는 이전에 "),n("code",[t._v("synchronized")]),t._v("를 활용한 동시성 이슈 해결에서 사용한 Product 엔티티를 재사용할 것이다. 추가된 부분은 "),n("code",[t._v("x-lock")]),t._v("을 건 뒤 조회하는 메서드가 추가 되었다.")]),t._v(" "),n("p",[t._v("MySQL은 가장 최신 버전인 "),n("code",[t._v("8.0.30")]),t._v("을 활용 했으며 기본 스토리지 엔진인 "),n("code",[t._v("InnoDB")]),t._v("를 사용 했다.")]),t._v(" "),n("h2",{attrs:{id:"비관적-락-적용"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#비관적-락-적용"}},[t._v("#")]),t._v(" 비관적 락 적용")]),t._v(" "),n("p",[t._v("비관적 락 적용은 "),n("code",[t._v("@Lock")]),t._v(" 애노테이션을 통해 쉽게 적용이 가능하다.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductRepository")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JpaRepository")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Lock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockModeType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PESSIMISTIC_WRITE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT p FROM Product p WHERE p.id = :id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Optional")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findByIdWithPessimisticLock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("@Lock(value = LockModeType.PESSIMISTIC_WRITE)")]),t._v("을 적용한 뒤 위 메서드를 수행하면 아래와 같은 쿼리를 확인할 수 있다.")]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" id1_0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" name2_0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("quantity "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" quantity3_0_\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" product product0_\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ? "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),t._v("\n")])])]),n("p",[n("code",[t._v("for update")]),t._v("란 키워드가 추가된 것을 확인할 수 있다. 이것이 의미하는 바는 조회하는 데이터를 수정하기 위해 "),n("code",[t._v("x-lock")]),t._v("을 걸었다는 의미이다. 다른 트랜잭션에서는 해제될 때 까지 기다리게 된다.")]),t._v(" "),n("p",[t._v("아래 테스트 코드를 수행해보면 정상적으로 통과하는 것을 확인할 수 있다.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootTest")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@DisplayNameGeneration")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReplaceUnderscores")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductServiceTest")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" 동시에_100개의_상품을_구매한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" product "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" productRepository"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"치킨"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100L")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" executorService "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("newFixedThreadPool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" countDownLatch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            executorService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("submit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("process")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" countDownLatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        countDownLatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" actual "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" productRepository"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("orElseThrow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("assertThat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("actual"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getQuantity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEqualTo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0L")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("process")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),t._v(" product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),t._v(" countDownLatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            productService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("purchase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1L")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            countDownLatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("countDown")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(426),alt:"img.png"}})]),t._v(" "),n("p",[t._v("이 방식에 가장 큰 장점은 충돌이 빈번하게 일어나는 상황에서 데이터의 정합성을 적절하게 지킬 수 있다는 것이다. 단점으로는 실제 데이터베이스에 락을 걸기 때문에 다수의 요청에 유연하게 대응하지 못한다.")]),t._v(" "),n("h2",{attrs:{id:"lock"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lock"}},[t._v("#")]),t._v(" @Lock")]),t._v(" "),n("p",[n("code",[t._v("@Lock")]),t._v(" 애노테이션은 트랜잭션 범위 내에서만 유효하다. 비관적 락을 걸기 위한 "),n("code",[t._v("LockModeType")]),t._v("은 3 가지가 존재한다.")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("PESSIMISTIC_READ")]),t._v(": "),n("code",[t._v("s-lock")]),t._v("을 건다.")]),t._v(" "),n("li",[n("code",[t._v("PESSIMISTIC_WRITE")]),t._v(": "),n("code",[t._v("x-lock")]),t._v("을 건다. 앞서 동시성 이슈 해결을 위해 적용한 "),n("code",[t._v("LockModeType")]),t._v("이다.")]),t._v(" "),n("li",[n("code",[t._v("PESSIMISTIC_FORCE_INCREMENT")]),t._v(": 버전 업데이트와 함께 "),n("code",[t._v("x-lock")]),t._v("을 수행한다. version 칼럼이 추가적으로 필요한 것으로 판단되는데 자세한 사용 예시는 아직 떠오르지 않는다.")])]),t._v(" "),n("p",[n("code",[t._v("@Lock(value = LockModeType.PESSIMISTIC_READ)")]),t._v(", "),n("code",[t._v("s-lock")]),t._v("을 활용할 경우 아래와 같은 쿼리를 확인할 수 있다.")]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" id1_0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" name2_0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("quantity "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" quantity3_0_\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" product product0_\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" product0_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ? "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("share")]),t._v("\n")])])]),n("p",[n("code",[t._v("for share")]),t._v("는 "),n("code",[t._v("s-lock")]),t._v("으로, 트랜잭션이 끝날 때 까지 조회한 레코드가 변경되지 않는 것을 보장한다. 해당 레코드를 수정하려는 다른 트랜잭션은 락이 해제될 때 까지 대기하게 된다. 다만 "),n("code",[t._v("s-lock")]),t._v("\n이기 때문에 여러 트랜잭션에서 "),n("code",[t._v("조회")]),t._v("는 가능하다.")]),t._v(" "),n("p",[t._v("이러한 특성 때문에 "),n("code",[t._v("교착상태(deadlock)")]),t._v("에 빠질 가능성이 높다. 관련 사례는\n"),n("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-deadlock-example.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("15.7.5.1 An InnoDB Deadlock Example"),n("OutboundLink")],1),t._v("에 잘 설명되어 있다.")]),t._v(" "),n("p",[t._v("간단한 예시를 들어보면 두 트랜잭션이 동시에 "),n("code",[t._v("s-lock")]),t._v("을 통해 레코드를 조회 했다고 가정한다. 두 트랜잭션은 조회된 레코드를 "),n("code",[t._v("UPDATE")]),t._v("한다. "),n("code",[t._v("UPDATE")]),t._v("나 "),n("code",[t._v("DELETE")]),t._v("를 위해서는 "),n("code",[t._v("x-lock")]),t._v("이\n필요하다. 두 트랜잭션은 서로 "),n("code",[t._v("x-lock")]),t._v("을 획득하기 위해 "),n("code",[t._v("s-lock")]),t._v("이 해제될 때 까지 기다린다. 결국 두 트랜잭션 모두 "),n("code",[t._v("x-lock")]),t._v("을 획득하지 못한 채 "),n("code",[t._v("deadlock")]),t._v("이 발생한다.")]),t._v(" "),n("p",[t._v("그림으로 표현하면 아래와 같다.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(427),alt:"img.png"}})]),t._v(" "),n("p",[t._v("조회 메서드를 "),n("code",[t._v("@Lock(value = LockModeType.PESSIMISTIC_READ)")]),t._v("으로 수정한 뒤 테스트를 수행하면 "),n("code",[t._v("ERROR log")]),t._v("와 함께 테스트가 실패한다.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductRepository")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JpaRepository")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Lock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockModeType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PESSIMISTIC_READ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT p FROM Product p WHERE p.id = :id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Optional")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findByIdWithPessimisticLock")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-12-12 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":56:50.399  WARN "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("96139")]),t._v(" --- "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ool-1-thread-10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" o.h.engine.jdbc.spi.SqlExceptionHelper   "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" SQL Error: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1213")]),t._v(", SQLState: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("40001")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-12-12 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":56:50.402 ERROR "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("96139")]),t._v(" --- "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("pool-1-thread-2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" o.h.engine.jdbc.spi.SqlExceptionHelper   "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" Deadlock found when trying to get lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" try restarting transaction\n")])])]),n("p",[n("img",{attrs:{src:a(428),alt:"img.png"}})]),t._v(" "),n("h2",{attrs:{id:"번외-조회-없이-바로-update"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#번외-조회-없이-바로-update"}},[t._v("#")]),t._v(" [번외] 조회 없이 바로 UPDATE")]),t._v(" "),n("p",[t._v("예제를 작성하던 중 복잡하지 않은 비즈니스 로직인데 "),n("code",[t._v("for update")]),t._v("를 통해 조회하지 않고 바로 "),n("code",[t._v("UPDATE")]),t._v("를 진행해도 되지 않을까라는 의문이 생겼다. 가령 아래와 같이 말이다.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductRepository")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JpaRepository")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Modifying")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE Product p "')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SET p.quantity = p.quantity - :quantity "')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WHERE p.id = :id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decreaseQuantity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" quantity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductService")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Transactional")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("purchase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" quantity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        productRepository"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decreaseQuantity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("quantity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("쿼리를 살펴보면 아래와 같다.")]),t._v(" "),n("div",{staticClass:"language-sql extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),t._v(" product\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" quantity "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" quantity "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" ?\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" id "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ?\n")])])]),n("p",[t._v("실제 테스트를 수행해도 통과한다.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(429),alt:"img.png"}})]),t._v(" "),n("p",[t._v("다만 무조건 요청이 100번만 온다는 보장이 없기 때문에 수량 보다 많은 요청이 들어온다고 가정한 뒤 테스트를 진행했다.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(430),alt:"img.png"}})]),t._v(" "),n("p",[t._v("쿼리에 수량에 대한 조건이 없기 때문에 우리가 요구사항이 만족하지 않는다. 이때 쿼리에 수량에 대한 조건을 추가한다.")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductRepository")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JpaRepository")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Modifying")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE Product p "')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SET p.quantity = p.quantity - :quantity "')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WHERE p.id = :id AND p.quantity > 0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decreaseQuantity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" quantity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("위 쿼리는 한 번에 요구사항 처리가 가능하지만 데이터베이스에 굉장히 종속적인 방법이라고 할 수 있다. 기존 방법인 "),n("code",[t._v("x-lock")]),t._v("을 통한 조회 이후 "),n("code",[t._v("UPDATE")]),t._v("를 수행할 경우 애플리케이션 레벨에서 제약 조건을\n확인할 수 있다는 장점이 있다. 각 상황에 맞춰서 적절한 방법을 선택하면 좋을 것 같다.")]),t._v(" "),n("h2",{attrs:{id:"정리"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#정리"}},[t._v("#")]),t._v(" 정리")]),t._v(" "),n("p",[t._v("지금까지 비관적 락을 활용한 동시성 이슈 해결 방법에 대해 알아보았다. 비관적 락은 공유 자원인 데이터베이스에 락을 걸어 하나의 트랜잭션만 처리할 수 있도록 상호배제를 달성한다. 다중 애플리케이션 서버와 단일\n데이터베이스의 경우 이러한 방식은 동시성 이슈에 대한 빠른 해결책이 될 수 있다.")]),t._v(" "),n("p",[t._v("하지만 데이터베이스에 직접 락을 걸기 때문에 락이 걸린 자원에 접근하는 트랜잭션은 대기하게 된다. 트랜잭션이 늘어날수록 대기하는 시간을 길어질 것이다. 즉 성능 상에 문제가 생길 수 있다.")]),t._v(" "),n("p",[t._v("다음 시간에는 데이터베이스에 직접 락을 걸지 않고 version이라는 추가적인 칼럼을 통해 동시성 이슈를 해결하는 방법에 대해 알아볼 예정이다.")]),t._v(" "),n("h2",{attrs:{id:"references"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References.")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-deadlock-example.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("15.7.5.1 An InnoDB Deadlock Example"),n("OutboundLink")],1),n("br"),t._v(" "),n("a",{attrs:{href:"https://www.inflearn.com/course/%EB%8F%99%EC%8B%9C%EC%84%B1%EC%9D%B4%EC%8A%88-%EC%9E%AC%EA%B3%A0%EC%8B%9C%EC%8A%A4%ED%85%9C",target:"_blank",rel:"noopener noreferrer"}},[t._v("재고시스템으로 알아보는 동시성이슈 해결방법"),n("OutboundLink")],1)]),t._v(" "),n("TagLinks")],1)}),[],!1,null,null,null);s.default=e.exports}}]);