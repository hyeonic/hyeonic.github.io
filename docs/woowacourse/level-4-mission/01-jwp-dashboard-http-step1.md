---
title: 01. í†°ìº£ êµ¬í˜„í•˜ê¸°
tags: ['ìš°ì•„í•œí…Œí¬ì½”ìŠ¤', 'ë¯¸ì…˜']
date: 2022-09-11 22:00:00
feed:
  enable: true
---

# 01. í†°ìº£ êµ¬í˜„í•˜ê¸°

ë²Œì¨ ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ ë ˆë²¨ 4ê°€ ì‹œì‘ ë˜ì—ˆë‹¤. 2ì›”ì„ ì‹œì‘ìœ¼ë¡œ ë²Œì¨ 7ê°œì›”ì´ ë„˜ëŠ” ì‹œê°„ì´ í˜ë €ë‹¤. ë ˆë²¨ 1ì—ì„œëŠ” ê¸°ë³¸ì ì¸ java ë¬¸ë²•ê³¼ TDDë¥¼ í™œìš©í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, ë ˆë²¨ 2ì—ì„œëŠ” Spring frameworkë¥¼ í™œìš©í•œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œê³¼ ë°°í¬ ë“±ì— ëŒ€í•´ í•™ìŠµ í•˜ì˜€ë‹¤. ë ˆë²¨ 3ì—ì„œëŠ” íŒ€ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í–ˆê¸° ë•Œë¬¸ì— ì¶”ê°€ì ì¸ ë¯¸ì…˜ì€ ì§„í–‰í•˜ì§€ ì•Šì•˜ë‹¤. 

ë ˆë²¨ 4ì—ì„œëŠ” ê¸°ì¡´ ë ˆë²¨ 1, 2, 3ì™€ëŠ” ì¡°ê¸ˆ ë‹¤ë¥´ê²Œ ì§„í–‰ëœë‹¤. ë¬´ì—‡ë³´ë‹¤ ë‚´ìš© ìš”ì•½ì´ë‚˜ ë°˜ë³µì ì¸ ì•”ê¸°ê°€ ì•„ë‹Œ `ëª©ì ì— ëŒ€í•´ ê³ ë¯¼`í•˜ê³ , ì‹¤ìŠµì„ í†µí•œ ì—°ìŠµê³¼ ì‹¤ì œ í”„ë¡œì íŠ¸ ì ìš© ë“± `ëŠ¥ë™ì ì¸ í•™ìŠµ ë°©ë²•`ì— ëŒ€í•´ ê°•ì¡°í•˜ê³  ìˆë‹¤.

ë˜í•œ ë ˆë²¨ 1, 2 ë¯¸ì…˜ê³¼ ë‹¤ë¥´ê²Œ í¬ë£¨ê°€ ì§ì ‘ ë¦¬ë·°ì–´ê°€ ë˜ì–´ ë¦¬ë·°ë¥¼ ë‚¨ê¸°ë„ë¡ í•œë‹¤. ë‚˜ ë˜í•œ ëˆ„êµ°ê°€ì˜ ë¦¬ë·°ì–´ê°€ ë˜ì–´ ë¯¸ì…˜ì„ í•¨ê»˜ ì§„í–‰í•œë‹¤. ëˆ„êµ°ê°€ ë‚˜ì—ê²Œ ë‚¨ê¸´ ë¦¬ë·°ì— ëŒ€í•´ ì˜ ì´í•´ í•˜ê³  ë‚˜ì˜ ìƒê°ì„ ë‚¨ê¸°ëŠ” ê²ƒë„ ì¤‘ìš”í•˜ì§€ë§Œ, ë¦¬ë·°ì–´ì˜ ì…ì¥ì—ì„œ ìƒëŒ€ë°©ì˜ ì˜ë„ë¥¼ ì ì ˆíˆ ëŒì–´ë‚´ëŠ” ê²ƒë„ ë§¤ìš° ì¤‘ìš”í•œ ì—­ëŸ‰ì´ë¼ ìƒê°í•œë‹¤. ì´ë²ˆ ê¸°íšŒë¥¼ í†µí•´ ì´ëŸ¬í•œ ì—­ëŸ‰ì„ í•¨ê»˜ í‚¤ìš¸ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ì„œ ë¯¸ì…˜ ê¸°ê°„ ë‚´ë‚´ ì¬ë¯¸ìˆê²Œ ì§„í–‰í–ˆë‹¤. ì•„ì§ ë¯¸ìˆ™í•œ ì ì´ ë§ì•„ ë‹¤ë¥¸ í¬ë£¨ì˜ ë¦¬ë·°ì™€ ë‚´ê°€ ì´ì „ì— ë¦¬ë·°ì–´ì—ê²Œ ë°›ì€ ë¦¬ë·°ë¥¼ í†µí•´ ì–´ë– í•œ ë¶€ë¶„ì„ ì¤‘ì ì ìœ¼ë¡œ ë¦¬ë·°í•˜ë©´ ì¢‹ì€ì§€ ê³ ë¯¼í•´ë³´ë©´ í–¥í›„ ë¦¬ë·°ì–´ì˜ ì—­í• ì—ì„œ ë³´ë‹¤ ë” `ìœ ì˜ë¯¸í•œ ì„±ì¥`ì„ í•  ìˆ˜ ìˆì„ ê²ƒì´ë¼ íŒë‹¨í•œë‹¤.

ë ˆë²¨ 4ì˜ ì²« ë¯¸ì…˜ì€ ë°”ë¡œ `í†°ìº£ êµ¬í˜„í•˜ê¸°`ì´ë‹¤. í†°ìº£ êµ¬í˜„í•˜ê¸° ë¯¸ì…˜ì€ ì•„ë˜ì™€ ê°™ì€ í•™ìŠµ ëª©í‘œë¥¼ ê°€ì§€ê³  ìˆë‹¤.

 * HTTPì™€ ì„œë¸”ë¦¿ì— ëŒ€í•œ ì´í•´ë„ë¥¼ ë†’ì¸ë‹¤.
 * ìŠ¤ë ˆë“œ, ìŠ¤ë ˆë“œí’€ì„ ì ìš©í•´ë³´ê³  ë™ì‹œì„± ì²˜ë¦¬ë¥¼ ê²½í—˜í•œë‹¤.

í†°ìº£ì˜ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. í†°ìº£ êµ¬í˜„ì„ í†µí•´ HTTP í”„ë¡œí† ì½œì— ëŒ€í•œ êµ¬ì¡°ë¥¼ ìµíˆê³  ì§ì ‘ ì„œë¸”ë¦¿ì„ êµ¬í˜„í•˜ë©° ì›¹ ì„œë²„ì˜ ì—­í• ê³¼ ëª©ì ì— ëŒ€í•´ì„œë„ ê³ ë¯¼í•  ìˆ˜ ìˆë‹¤. ì´ ë°–ì—ë„ íŒ¨í‚¤ì§€ êµ¬ì¡°ë¥¼ í†µí•œ ì˜ì¡´ì„± ë“± ê³ ë¯¼í•´ì•¼í•  í¬ì¸íŠ¸ë“¤ì´ ë§ë‹¤.

> ì´ ê¸€ì€ ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ì—ì„œ ì§„í–‰í•œ ë¯¸ì…˜ì˜ ë¦¬ë·°ì™€ ë‚˜ì˜ ê³ ë¯¼ê³¼ ìƒê°ì— ëŒ€í•´ ì •ë¦¬í•œë‹¤. ì‹¤ì œ ë¦¬ë·°ëŠ” [[í†°ìº£ êµ¬í˜„í•˜ê¸° - 1ë‹¨ê³„] ë§¤íŠ¸(ìµœê¸°í˜„) ë¯¸ì…˜ ì œì¶œí•©ë‹ˆë‹¤.](https://github.com/woowacourse/jwp-dashboard-http/pull/125)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## ìš”êµ¬ì‚¬í•­ íŒŒì•…í•˜ê¸°

ì´ë²ˆ ë¯¸ì…˜ì€ í¬ê²Œ `4 ë‹¨ê³„`ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤. ì•„ë˜ëŠ” ê° ë‹¨ê³„ ë³„ ì²´í¬ ë¦¬ìŠ¤íŠ¸ ì¤‘ ì´ë²ˆ 1ì°¨ ì œì¶œì—ì„œ êµ¬í˜„í•œ ê²ƒì„ í‘œì‹œí•œ ê²ƒì´ë‹¤.

### ğŸš€ 1ë‹¨ê³„ - HTTP ì„œë²„ êµ¬í˜„í•˜ê¸°

 * [x] http://localhost:8080/index.html í˜ì´ì§€ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤.
 * [x] ì ‘ê·¼í•œ í˜ì´ì§€ì˜ js, css íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.
 * [x] uriì˜ QueryStringì„ íŒŒì‹±í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤.

### ğŸš€ 2ë‹¨ê³„ - ë¡œê·¸ì¸ êµ¬í˜„í•˜ê¸°

 * [x] HTTP Reponseì˜ ìƒíƒœ ì‘ë‹µ ì½”ë“œë¥¼ 302ë¡œ ë°˜í™˜í•œë‹¤.
 * [x] POSTë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì˜ Request Bodyë¥¼ íŒŒì‹±í•  ìˆ˜ ìˆë‹¤.
 * [ ] ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ HTTP Reponseì˜ í—¤ë”ì— Set-Cookieê°€ ì¡´ì¬í•œë‹¤.
 * [ ] ì„œë²„ì— ì„¸ì…˜ì„ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ê°€ ìˆê³ , ì¿ í‚¤ë¡œë¶€í„° ì „ë‹¬ ë°›ì€ JSESSIONID ê°’ì´ ì €ì¥ëœë‹¤.

### ğŸš€ 3ë‹¨ê³„ - ë¦¬íŒ©í„°ë§

 * [x] HTTP Request, HTTP Response í´ë˜ìŠ¤ë¡œ ë‚˜ëˆ ì„œ êµ¬í˜„í–ˆë‹¤.
 * [x] Controller ì¸í„°í˜ì´ìŠ¤ì™€ RequestMapping í´ë˜ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ ifì ˆì„ ì œê±°í–ˆë‹¤.

### ğŸš€ 4ë‹¨ê³„ - ë™ì‹œì„± í™•ì¥í•˜ê¸°

 * [ ] Executorsë¡œ ë§Œë“  ExecutorService ê°ì²´ë¥¼ í™œìš©í•˜ì—¬ ìŠ¤ë ˆë“œ ì²˜ë¦¬ë¥¼ í•˜ê³  ìˆë‹¤.

ì•„ì‰½ê²Œë„ ë¯¸ì…˜ì˜ ì˜ë„ì™€ ë‹¤ë¥´ê²Œ ìˆœì°¨ì ìœ¼ë¡œ ë¯¸ì…˜ì„ í•´ê²°í•˜ì§€ ëª»í–ˆë‹¤. 1ë‹¨ê³„ë¥¼ ì§„í–‰í•˜ë˜ ì¤‘ ë°˜ë³µì ì¸ `if`ì ˆê³¼ HTTP ìš”ì²­ê³¼ ì‘ë‹µì„ ìœ„í•´ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” `HttpRequest`ì™€ `HttpResponse`ì˜ `ê°ì²´ì˜ ì±…ì„`ì´ ëšœë ·í•´ì ¸ ìš°ì„ ì ìœ¼ë¡œ ê³ ë ¤í•˜ê²Œ ë˜ì—ˆë‹¤. ë•ë¶„ì— ë‚˜ë¨¸ì§€ 2ë‹¨ê³„ë¥¼ í•´ê²°í•  ë•Œ ë³´ë‹¤ ë” ì‰½ê²Œ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆì„ ê±°ë¼ ê¸°ëŒ€í•œë‹¤.

## í†°ìº£ì´ë€?

ì´ë²ˆ ë¯¸ì…˜ì€ ë¬´ì—‡ë³´ë‹¤ í†°ìº£ì„ êµ¬í˜„í•˜ëŠ” ê²ƒì´ë‹¤. ê·¸ë ‡ë‹¤ë©´ ìš°ë¦¬ëŠ” í†°ìº£ì€ ë¬´ì—‡ì´ë©° ì–´ë– í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ê²ƒì¸ì§€ ì•Œì•„ì•¼ í•œë‹¤ê³  ìƒê°í–ˆë‹¤. [Tomcat](https://hyeonic.github.io/infra/basic/tomcat.html)ì€ ë¯¸ì…˜ ì‹œì‘ ì „ í†°ìº£ì€ ë¬´ì—‡ì¸ì§€ ê°„ë‹¨íˆ ì •ë¦¬í•œ ê²ƒì´ë‹¤.

ê¸€ì—ì„œ ì–¸ê¸‰í•œ ê²ƒ ì²˜ëŸ¼, `í†°ìº£`ì€ `Java EE(Jakarta EE)`ì˜ `Web Container(Servlet Container)` ìŠ¤í™ì˜ êµ¬í˜„ì´ë©°, HTTPì— ëŒ€í•œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ë™í•  ìˆ˜ ìˆëŠ” `server`ì´ë‹¤.

> Java EE(Jakarta EE)ì˜ ëª¨ë“  ìŠ¤í™ì„ êµ¬í˜„í•œ ê²ƒì„ WASë¼ í•œë‹¤. ë³´í†µ Web Container(Servlet Container)ë¥¼ êµ¬í˜„í•˜ë©´ í†µìƒì ìœ¼ë¡œ WASë¼ ë¶ˆë¦°ë‹¤.

## try-with-resources

ìš°ë¦¬ëŠ” `ServerSocket`ì— ì„¤ì •í•œ `port`ë¥¼ í†µí•´ ì—°ê²° ìš”ì²­ì„ ê¸°ë‹¤ë¦°ë‹¤. 

```java
public class Connector implements Runnable {
    ...
    private static final int DEFAULT_PORT = 8080;
    private static final int DEFAULT_ACCEPT_COUNT = 100;

    private final ServerSocket serverSocket;
    private boolean stopped;

    public Connector() {
        this(DEFAULT_PORT, DEFAULT_ACCEPT_COUNT);
    }

    public Connector(final int port, final int acceptCount) {
        this.serverSocket = createServerSocket(port, acceptCount);
        this.stopped = false;
    }

    private ServerSocket createServerSocket(final int port, final int acceptCount) {
        try {
            final int checkedPort = checkPort(port);
            final int checkedAcceptCount = checkAcceptCount(acceptCount);
            return new ServerSocket(checkedPort, checkedAcceptCount);
        } catch (IOException e) {
            throw new UncheckedIOException(e);
        }
    }
    ...
}
```

ìš”ì²­ì´ ì˜¤ë©´ í´ë¼ì´ì–¸íŠ¸ì™€ ì—°ê²°ì„ ë§ºê³  í•´ë‹¹ í´ë¼ì´ì–¸íŠ¸ì™€ í†µì‹ í•  ìˆ˜ ìˆëŠ” `Socket`ì„ ìƒì„± í•œ ë’¤ íŠ¹ì • í”„ë¡œí† ì½œì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” `Processor`ë¡œ ì „ë‹¬ëœë‹¤.

```java
public class Http11Processor implements Runnable, Processor {
    ...
    private final Socket connection;

    public Http11Processor(final Socket connection) {
        this.connection = connection;
    }

    @Override
    public void run() {
        process(connection);
    }

    @Override
    public void process(final Socket connection) {
        try (final var inputStream = connection.getInputStream();
             final var outputStream = connection.getOutputStream()) {
            ...
            outputStream.write(response.getBytes());
            outputStream.flush();
        } catch (IOException | UncheckedServletException e) {
            log.error(e.getMessage(), e);
        }
    }
}
```

ìš°ë¦¬ëŠ” ë¯¸ì…˜ì—ì„œëŠ” `HTTP 1.1` í”„í† í† ì½œ ì²˜ë¦¬ë¥¼ ìœ„í•œ `Http11Processor`ë¥¼ êµ¬í˜„í•˜ë„ë¡ ê°„ë‹¨í•œ ê¸°ë°˜ ì½”ë“œë¥¼ ì œê³µí•˜ê³  ìˆë‹¤. ìš°ë¦¬ëŠ” ì—°ê²°ëœ `connection`ì„ í†µí•´ ë°ì´í„°ë¥¼ ì½ì–´ HTTP Requestì— ëŒ€í•œ ì •ë³´ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤.

ì´ëŸ¬í•œ `Socket`ì€ ì•ì„œ ì–¸ê¸‰í•œ ê²ƒ ì²˜ëŸ¼ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•œ `ì—°ê²°`ì„ ë§ºëŠ” ê²ƒì´ë‹¤. ë§Œì•½ `Socket` ì‚¬ìš©ì´ ì™„ë£Œëœ ë’¤ ìì›ì„ ë°˜ë‚©í•˜ì§€ ì•Šìœ¼ë©´ ì„œë²„ì˜ ë¶ˆí•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì†Œë¹„í•˜ê²Œ ëœë‹¤. 

Java 7ì— ë„ì…ëœ `try-with-resources`ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ try ë¸”ë¡ì— ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ë¸”ë¡ì´ ì‹¤í–‰ëœ í›„ ë¦¬ì†ŒìŠ¤ê°€ ìë™ìœ¼ë¡œ ë‹«íŒë‹¤. ë‹¨ `Socket` ì²˜ëŸ¼ `AutoCloseable` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì ì ˆíˆ `êµ¬í˜„`í•´ì•¼ í•œë‹¤.

```java
public class Socket implements java.io.Closeable {
    ...
}
```

```java
public interface Closeable extends AutoCloseable {
    ...
}
```

ì´ëŸ¬í•œ `try-with-resources`ëŠ” `try ()`ì˜ `()`ì‚¬ì´ì— ì‘ì„±í•œ ìˆœì„œì˜ ì—­ìˆœìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ê°€ ë‹«íŒë‹¤. ì•„ë˜ëŠ” ë‚´ê°€ ì´ë²ˆ ë¯¸ì…˜ì— ì§ì ‘ ì‘ì„±í•œ ì½”ë“œ ì¤‘ ì¼ë¶€ë¥¼ ê°€ì ¸ì˜¨ ê²ƒì´ë‹¤.

```java
public class Http11Processor implements Runnable, Processor {
    @Override
    public void process(final Socket connection) {
        try (InputStream inputStream = connection.getInputStream(); // 1
             InputStreamReader inputStreamReader = new InputStreamReader(inputStream); // 2
             BufferedReader bufferedReader = new BufferedReader(inputStreamReader); // 3
             OutputStream outputStream = connection.getOutputStream() // 4
        ) {
            ...
        } catch (IOException e) {
            log.error(e.getMessage(), e);
        }
    }
}
```

`4 -> 3 -> 2 -> 1`ì˜ ìˆœì„œë¡œ ë¦¬ì†ŒìŠ¤ê°€ ë‹«íˆê²Œ ëœë‹¤.

ì£¼ì˜í•´ì•¼ í•  ì ì€ íŠ¹ì • ë¦¬ì†ŒìŠ¤ë¥¼ ë©”ì„œë“œë¡œ ë¶„ë¦¬í•˜ì—¬ ë‹¤ì‹œ í•œ ë²ˆ `try-with-resources`ë¡œ ë¬¶ì§€ ë§ì•„ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ì•„ë˜ ì½”ë“œë¥¼ ì‚´í´ë³´ì.

```java
public class Http11Processor implements Runnable, Processor {
    ...
    @Override
    public void process(final Socket connection) {
        try (InputStream inputStream = connection.getInputStream();
             OutputStream outputStream = connection.getOutputStream()) {
            ...
            getHttpResponse(inputStream, outputStream); // 1
            outputStream.write(...); // 2
            outputStream.flush(); // 3
        } catch (IOException e) {
            log.error(e.getMessage(), e);
        }
    }

    private HttpResponse getHttpResponse(final InputStream inputStream, final OutputStream outputStream) {
        try (InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
             BufferedReader bufferedReader = new BufferedReader(inputStreamReader)) {
            ...
        } catch (IOException e) {
            log.error(e.getMessage(), e);
        }
    }
}
```

ìœ„ì™€ ê°™ì´ `inputStream`ì„ ì¶”ê°€ì ì¸ ë©”ì„œë“œë¡œ ë¶„ë¦¬í•œ ë’¤ `try-with-resources`ë¥¼ ì‚¬ìš© í–ˆë‹¤ê³  ê°€ì •í•œë‹¤. í•´ë‹¹ ë©”ì„œë“œê°€ ëë‚˜ëŠ” ì‹œì ì— ì´ë¯¸ `inputStream`ê³¼ `outputStream`ì— ëŒ€í•œ ë¦¬ì†ŒìŠ¤ëŠ” ë‹«íˆê²Œ ëœë‹¤. ë” ë‚˜ì•„ê°€ `inputStream`ê³¼ `outputStream`ì„ íšë“í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œ `socket`ì˜ ë¦¬ì†ŒìŠ¤ë„ ë‹«íˆê²Œ ëœë‹¤. ê·¸ë¡œ ì¸í•˜ì—¬ `2, 3`ì„ ì‹¤í–‰í•˜ëŠ” ì‹œì ì— socketì´ ë‹«í˜€ ì•„ë˜ì™€ ê°™ì€ ì˜ˆì™¸ ìƒí™©ì„ ë§ˆì£¼í•  ìˆ˜ ìˆë‹¤.

```shell
00:45:41.839 [Thread-1] ERROR org.apache.coyote.http11.Http11Processor - Socket closed
java.net.SocketException: Socket closed
	at java.base/java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:113)
	at java.base/java.net.SocketOutputStream.write(SocketOutputStream.java:129)
    ...
```

## Servlet êµ¬í˜„í•˜ê¸°

Servletì€ ê³µì‹ ë¬¸ì„œì— ë”°ë¥´ë©´ `Java EE(Jakarta EE)`ì˜ ê¸°ìˆ  ê¸°ë°˜ `ì›¹ ì»´í¬ë„ŒíŠ¸`ë¡œ, ì»¨í…Œì´ë„ˆì— ì˜í•´ ê´€ë¦¬ë˜ë©° `ë™ì  ì½˜í…ì¸ `ë¥¼ ìƒì„±í•œë‹¤. Servletì€ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ ì²˜ëŸ¼ ì›¹ ì„œë²„ì— ë™ì ìœ¼ë¡œ ë¡œë“œë˜ê³  ì‹¤í–‰ë  ìˆ˜ ìˆëŠ” ë°”ì´íŠ¸ ì½”ë“œë¡œ ì»´íŒŒì¼ ëœë‹¤. Servlet ì—”ì§„ì´ë¼ê³ ë„ í•˜ëŠ” ì»¨í…Œì´ë„ˆëŠ” Servlet ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì›¹ ì„œë²„ì˜ í™•ì¥ì´ë‹¤. Servletì€ Servlet Containerì— ì˜í•´ êµ¬í˜„ëœ ìš”ì²­/ì‘ë‹µ íŒ¨ëŸ¬ë‹¤ì„ì„ í†µí•´ ì›¹ í´ë¼ì´ì–¸íŠ¸ì™€ ìƒí˜¸ ì‘ìš©í•œë‹¤.

ë‚˜ëŠ” Servlet ëª…ì„¸ì™€ ìœ ì‚¬í•˜ê²Œ ì‘ì„±í•˜ê¸° ìœ„í•´ ì‹¤ì œ êµ¬í˜„ ì½”ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ì„¤ê³„ë¥¼ ì§„í–‰ í•˜ì˜€ë‹¤. ëª¨ë“  ëª…ì„¸ë¥¼ ë”°ë¼í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì´ë²ˆ ë¯¸ì…˜ì—ì„œ í•„ìš”í•œ ë¶€ë¶„ì„ ì ì ˆíˆ ì„ íƒí•˜ì—¬ êµ¬í˜„í•˜ì˜€ë‹¤. ì•„ë˜ëŠ” ì‹¤ì œ ëª…ì„¸ê°€ ì íŒ `Servlet` ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.

```java
public interface Servlet {

    public void init(ServletConfig config) throws ServletException; // 1

    public ServletConfig getServletConfig(); // 2

    public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException; // 3

    public String getServletInfo(); // 4

    public void destroy(); // 5
}
```

 * `1`: Servlet ContainerëŠ” ì„œë¸”ë¦¿ì„ ì¸ìŠ¤í„´ìŠ¤í™”í•œ í›„ ì •í™•íˆ í•œ ë²ˆ init ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤. 
 * `2`: ì´ Servletì— ëŒ€í•œ ì´ˆê¸°í™” ë° ì‹œì‘ ë§¤ê°œë³€ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” `ServletConfig` ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. ë°˜í™˜ëœ `ServletConfig` ê°ì²´ëŠ” `init()` ë©”ì†Œë“œì— ì „ë‹¬ëœ ê°ì²´ì…ë‹ˆë‹¤.
 * `3`: Servletì´ ìš”ì²­ì— ì‘ë‹µí•  ìˆ˜ ìˆë„ë¡ Servlet Containerì— ì˜í•´ í˜¸ì¶œëœë‹¤. ì´ ë©”ì†Œë“œëŠ” Servletì˜ `init()` ë©”ì†Œë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëœ í›„ì—ë§Œ í˜¸ì¶œëœë‹¤.
 * `4`: Servletì— ëŒ€í•œ ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤.
 * `5`: ì´ ë©”ì†Œë“œëŠ” Servletì˜ `service()` ë©”ì†Œë“œ ë‚´ì˜ ëª¨ë“  ìŠ¤ë ˆë“œê°€ ì¢…ë£Œë˜ê±°ë‚˜ ì‹œê°„ ì´ˆê³¼ ê¸°ê°„ì´ ê²½ê³¼í•œ í›„ì—ë§Œ í˜¸ì¶œëœë‹¤.

`init()`, `destory()`ì˜ ê²½ìš° ì„œë¸”ë¦¿ì˜ ìƒëª… ì£¼ê¸°ì™€ ê´€ë ¨ì´ ê¹Šë‹¤. ì´ë²ˆ ë¯¸ì…˜ì—ì„œëŠ” Servlet Containerë¥¼ ì „ë¶€ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ìµœì†Œí•œì˜ ê¸°ëŠ¥ë§Œ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ `service()` ë©”ì„œë“œë§Œ ì°¸ê³  í•˜ì˜€ë‹¤. ì‹¤ì œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ Servlet Containerë¥¼ í†µí•´ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì„œë¸”ë¦¿ì˜ `service()` ë©”ì„œë“œê°€ ì‹¤í–‰ë  ê²ƒì´ë‹¤.

ì•„ë˜ëŠ” ì´ë²ˆ ë¯¸ì…˜ì—ì„œ ì‘ì„±í•œ `Servlet` ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.

```java
public interface Servlet {

    boolean isSupported(final String path); // 1

    void service(final HttpRequest httpRequest, final HttpResponse httpResponse); // 2
}
```
 
 * `1`: ì‹¤ì œ Servletì˜ ê²½ìš° xmlì´ë‚˜ ì• ë…¸í…Œì´ì…˜ ì„¤ì •ì„ í†µí•´ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” `url pattern`ì„ ì§€ì •í•œë‹¤. ìœ ì‚¬í•˜ê²Œ í•´ë‹¹ ë¡œì§ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ Servlet ë©”ì„œë“œê°€ í•´ë‹¹ pathë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ì—¬ë¶€ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤.
 * `2`: ì„ íƒëœ ì„œë¸”ë¦¿ì´ ì§„í–‰í•  í–‰ìœ„ë¥¼ ëª…ì‹œí•œë‹¤.

ë‹¤ìŒì€ `HttpServlet`ì´ë‹¤. ì‹¤ì œ ëª…ì„¸ì— ë”°ë¥´ë©´ ì›¹ ì‚¬ì´íŠ¸ì— ì í•©í•œ HTTP ì„œë¸”ë¦¿ì„ ìƒì„±í•˜ê¸° ìœ„í•´ ì„œë¸Œí´ë˜ì‹±í•  ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ ì œê³µí•˜ê³  ìˆë‹¤. `HttpServlet` ì˜ í•˜ìœ„ í´ë˜ìŠ¤ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì¸ ì ì–´ë„ í•˜ë‚˜ì˜ ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•´ì•¼ í•œë‹¤.

 * doGet, if the servlet supports HTTP GET requests
 * doPost, for HTTP POST requests
 * doPut, for HTTP PUT requests
 * doDelete, for HTTP DELETE requests
 ...

ì‹¤ì œ ëª…ì„¸ì— ì‘ì„±ëœ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```java
public abstract class HttpServlet extends GenericServlet {
    ...
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
        throws ServletException, IOException
    {
        String msg = lStrings.getString("http.method_get_not_supported");
        sendMethodNotAllowed(req, resp, msg);
    }
    ...
    protected void doPost(HttpServletRequest req, HttpServletResponse resp)
        throws ServletException, IOException {

        String msg = lStrings.getString("http.method_post_not_supported");
        sendMethodNotAllowed(req, resp, msg);
    }
    ...
    protected void doPut(HttpServletRequest req, HttpServletResponse resp)
        throws ServletException, IOException {

        String msg = lStrings.getString("http.method_put_not_supported");
        sendMethodNotAllowed(req, resp, msg);
    }
    ...
        protected void doDelete(HttpServletRequest req,
                            HttpServletResponse resp)
        throws ServletException, IOException {

        String msg = lStrings.getString("http.method_delete_not_supported");
        sendMethodNotAllowed(req, resp, msg);
    }
    ...
}
```

ëª¨ë‘ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì¢‹ê² ì§€ë§Œ ìš°ë¦¬ëŠ” `GET`, `POST`ì— ëŒ€í•œ ìš”ì²­ë§Œ ì²˜ë¦¬í•˜ë¯€ë¡œ ê°„ì¶”ë ¤ì„œ ì‘ì„± í•˜ì˜€ë‹¤. ì•„ë˜ëŠ” ë‚´ê°€ ì§ì ‘ ì‘ì„±í•œ `HttpServlet`ì´ë‹¤.

```java
public abstract class HttpServlet implements Servlet {

    public void service(final HttpRequest httpRequest, final HttpResponse httpResponse) {
        if (httpRequest.getHttpMethod() == HttpMethod.GET) {
            doGet(httpRequest, httpResponse);
            return;
        }

        if (httpRequest.getHttpMethod() == HttpMethod.POST) {
            doPost(httpRequest, httpResponse);
            return;
        }
        ...
    }

    protected abstract void doGet(final HttpRequest httpRequest, final HttpResponse httpResponse);

    protected abstract void doPost(final HttpRequest httpRequest, final HttpResponse httpResponse);
}
```

ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì˜ `HTTP Method`ë¥¼ íŒë‹¨í•˜ì—¬ `doGet()`, `doPost()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê³  ìˆë‹¤. ì´ì œ ì‹¤ì œ ìš”ì²­ì„ ì²˜ë¦¬í•  `Servlet` ê°ì²´ë¥¼ ë§Œë“¤ì–´ë³´ì. ìš°ì„  `HttpServlet`ì„ ìƒì† í•œë‹¤.

ì•„ë˜ëŠ” íšŒì›ê°€ì…ì— ëŒ€í•œ ìš”ì²­ ì²˜ë¦¬ë¥¼ ìœ„í•œ `RegisterServlet`ì´ë‹¤. ë§Œì•½ `/register`ì™€ ë™ì¼í•œ pathì˜ ìš”ì²­ì¸ ê²½ìš° í•´ë‹¹ ì„œë¸”ë¦¿ì´ ì‹¤í–‰ë  ê²ƒì´ë‹¤.

```java
public class RegisterServlet extends HttpServlet {

    private static final Logger log = LoggerFactory.getLogger(RegisterServlet.class);
    private static final String PATH = "/register";

    @Override
    public boolean isSupported(final String path) {
        return PATH.equals(path);
    }

    @Override
    protected void doGet(final HttpRequest httpRequest, final HttpResponse httpResponse) {
        httpResponse.addStatusCode(StatusCode.OK);
        httpResponse.addView("register.html");
    }

    @Override
    protected void doPost(final HttpRequest httpRequest, final HttpResponse httpResponse) {
        if (!httpRequest.hasRequestParameter("account", "password", "email")) {
            httpResponse.addStatusCode(StatusCode.OK);
            httpResponse.addView("login.html");
        }

        String account = httpRequest.getRequestParameter("account");
        String password = httpRequest.getRequestParameter("password");
        String email = httpRequest.getRequestParameter("email");

        User user = new User(account, password, email);
        InMemoryUserRepository.save(user);
        log.info("{} íšŒì›ê°€ì… ì„±ê³µ!", user.getAccount());

        httpResponse.sendRedirect("/index.html");
    }
}
```

ì•ì„œ ì–¸ê¸‰í•œ ê²ƒ ì²˜ëŸ¼ `HttpServlet`ì˜ `ì¶”ìƒ ë©”ì„œë“œ`ì¸ `doGet()`, `doPost()`ë¥¼ ì ì ˆíˆ `Override`í•˜ì—¬ ë©”ì„œë“œ ë³„ í–‰ìœ„ë¥¼ ì§€ì •í•˜ë„ë¡ í•˜ì˜€ë‹¤.

ì ì´ì œ ì‘ì„±í•œ Servletë¥¼ ìƒì„±í•˜ê³  ì„ íƒí•˜ê¸° ìœ„í•œ `ServletContainer`ë¥¼ ì‘ì„±í•œë‹¤.

```java
public class ServletContainer {

    private static final List<Servlet> SERVLETS = List.of(new IndexServlet(), new LoginServlet(), new RegisterServlet());
    private static final Servlet NOT_FOUND_SERVLET = new NotFoundServlet();

    private ServletContainer() {
    }

    public static Servlet findByPath(final String path) {
        return SERVLETS.stream()
                .filter(servlet -> servlet.isSupported(path))
                .findFirst()
                .orElse(NOT_FOUND_SERVLET);
    }
}
```

êµ¬ì¡°ëŠ” ë§¤ìš° ê°„ë‹¨í•˜ë‹¤. í˜„ì¬ ì‘ì„±ëœ Servletì„ ìˆœíšŒí•˜ë©° `isSupported()`ë¡œ ì²˜ë¦¬ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤. ì²˜ë¦¬ ê°€ëŠ¥í•œ Servletì´ ìˆë‹¤ë©´ ë°˜í™˜í•˜ê³  ì—†ìœ¼ë©´ `404.html`ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” Servletì„ ë°˜í™˜í•œë‹¤.

ì´ì œ ì•„ë˜ì™€ ê°™ì´ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ `path`ë¥¼ ì „ë‹¬í•˜ì—¬ ì ì ˆí•œ Servletì„ ì°¾ì•„ `service()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.

```java
public class Http11Processor implements Runnable, Processor {
    ...
    @Override
    public void process(final Socket connection) {
        try (InputStream inputStream = connection.getInputStream();
             InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
             BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
             OutputStream outputStream = connection.getOutputStream()) {

            HttpRequest httpRequest = generateHttpRequest(bufferedReader);
            HttpResponse httpResponse = new HttpResponse();

            Servlet servlet = ServletContainer.findByPath(httpRequest.getPath());
            servlet.service(httpRequest, httpResponse);

            write(outputStream, httpResponse);
        } catch (IOException e) {
            log.error(e.getMessage(), e);
        }
    }
}
```

## íŒ¨í‚¤ì§€ êµ¬ì¡°ì™€ ì•„ì‰¬ìš´ ì 

ë‚˜ëŠ” ì´ë²ˆ ë¯¸ì…˜ ì½”ë“œë¥¼ ì²˜ìŒ ë´¤ì„ ë•Œ í¬ê²Œ ë‘ ê°œì˜ í”„ë¡œì íŠ¸ë¡œ ë‚˜ë‰œë‹¤ê³  ìƒê°í–ˆë‹¤. í•˜ë‚˜ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìš°ë¦¬ê°€ ê°œë°œí•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜, ë‚˜ë¨¸ì§€ í•˜ë‚˜ëŠ” í†°ìº£ì´ë¼ê³  ì—¼ë‘ í•œ ë’¤ ë¯¸ì…˜ì„ ì§„í–‰í•˜ì˜€ë‹¤.

ë‚´ íŒë‹¨ìœ¼ë¡œëŠ” ì ì–´ë„ í†°ìº£ ë‚´ë¶€ì—ëŠ” ìš°ë¦¬ê°€ ê°œë°œ ì¤‘ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ì—†ì• ì•¼ í•œë‹¤ê³  ìƒê°í–ˆë‹¤. ì´ìœ ëŠ” í†°ìº£ì€ ë³´ë‹¤ ë” ë²”ìš©ì ì¸ ëª©ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì²˜ëŸ¼ ëŠê»´ì¡Œê¸° ë•Œë¬¸ì´ë‹¤.

í•˜ì§€ë§Œ ê²°ê³¼ì ìœ¼ë¡œ ì´ê²ƒì„ ì´ë¤„ë‚´ì§€ ëª»í–ˆë‹¤. ì´ìœ ëŠ” ë°”ë¡œ `ServletContainer` ë•Œë¬¸ì´ë‹¤. `HttpServlet`ì€ ì‹¤ì œ ìš”ì²­ì— ë”°ë¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë¡œì§ì´ ë‹´ê²¨ìˆê¸° ë•Œë¬¸ì— ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ íŒ¨í‚¤ì§€ ë‚´ë¶€ì— ë‘ì—ˆë‹¤. í•˜ì§€ë§Œ `ServletContainer`ëŠ” í•´ë‹¹ Servletì— ëŒ€í•œ ì˜ì¡´ì„ ê°€ì ¸ì•¼ë§Œ í•œë‹¤. ê²°êµ­ ì• ë…¸í…Œì´ì…˜ì„ í™œìš©í•œ ë¦¬í”Œë ‰ì…˜ ë“± ì¶”ê°€ì ì¸ ì¡°ì¹˜ë¥¼ ì·¨í•˜ì§€ ì•Šìœ¼ë©´ ì§ì ‘ì ì¸ ì˜ì¡´ì„±ì„ í•´ê²°í•  ìˆ˜ ì—†ê²Œ ëœë‹¤.

```java
package org.apache.servlet; // í†°ìº£ êµ¬í˜„ì„ ìœ„í•œ íŒ¨í‚¤ì§€

import java.util.List;
import nextstep.jwp.controller.IndexServlet;    // ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜ì¡´!
import nextstep.jwp.controller.LoginServlet;    // ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜ì¡´!
import nextstep.jwp.controller.RegisterServlet; // ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜ì¡´!

public class ServletContainer {

    private static final List<Servlet> SERVLETS = List.of(new IndexServlet(), new LoginServlet(), new RegisterServlet());
    ...
}
```

ê²°êµ­ í†°ìº£ ë‚´ë¶€ì— ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ì „ë¶€ ëŠì–´ë‚´ì§€ ëª»í–ˆë‹¤. í˜„ì¬ ê°€ì¥ ë¹ ë¥´ê²Œ ì˜ì¡´ì„±ì„ ì œê±°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ `Application`ì—ì„œ Tomcatì„ ìƒì„±í•˜ëŠ” ì‹œì ì— ì•„ë˜ì™€ ê°™ì´ `Servlet` ë¦¬ìŠ¤íŠ¸ë¥¼ ì£¼ì…í•˜ëŠ” ë°©ì‹ì´ë‹¤.

```java
public class Application {
    private static final List<Servlet> SERVLETS = List.of(new IndexServlet(), new LoginServlet(), new RegisterServlet());
    private static final Logger log = LoggerFactory.getLogger(Application.class);

    public static void main(String[] args) {
        log.info("web server start.");
        final var tomcat = new Tomcat(SERVLETS); // servlet ë¦¬ìŠ¤íŠ¸ ì£¼ì…
        tomcat.start();
    }
}
```

ë‹¤ë§Œ ì´ê²ƒì€ ë¯¸ì…˜ì—ì„œ ì–»ê³ ì í•˜ëŠ” ê²ƒì— ì¡°ê¸ˆ ë²—ì–´ë‚  ìˆ˜ ìˆë‹¤ê³  íŒë‹¨í•´ì„œ ì ì ˆí•œ íƒ€í˜‘ìœ¼ë¡œ ì§ì ‘ ì˜ì¡´ì„ í†µí•´ ë¡œì§ì´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì— ì§‘ì¤‘ í•˜ì˜€ë‹¤. ìš°ì„  ì´ ë¬¸ì œì— ëŒ€í•´ ì¶©ë¶„íˆ ì¸ì§€í•˜ê³  ìˆìœ¼ë‹ˆ 2ì°¨ ì œì¶œ ë•Œ ë” ê³ ë¯¼í•œ ë’¤ ê°œì„ í•  ì˜ˆì •ì´ë‹¤.

## References.

[Java â€“ Try with Resources](https://www.baeldung.com/java-try-with-resources)<br>
[Jakarta Servlet 5.0 Specification Document (HTML)](https://jakarta.ee/specifications/servlet/5.0/jakarta-servlet-spec-5.0.html)<br>

<TagLinks />
